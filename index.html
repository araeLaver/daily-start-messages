<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¨ë‹ - ì•„ì¹¨ ë©”ì‹œì§€</title>
    <meta name="description" content="ìƒˆë¡œìš´ ì•„ì¹¨ì„ ì‹œì‘í•˜ëŠ” ë”°ëœ»í•˜ê³  í˜ì´ ë˜ëŠ” ë©”ì‹œì§€ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”">
    <meta name="theme-color" content="#f59e0b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ëª¨ë‹">
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/loader.css">
    <link rel="stylesheet" href="css/accessibility.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- ì ‘ê·¼ì„±: Skip to content ë§í¬ -->
    <a href="#main-content" class="skip-link">ë©”ì¸ ì½˜í…ì¸ ë¡œ ê±´ë„ˆë›°ê¸°</a>
    
    <!-- í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ -->
    <button class="hamburger-btn" id="hamburgerBtn" aria-label="ë©”ë‰´ ì—´ê¸°">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- ì‚¬ì´ë“œë°” ë©”ë‰´ -->
    <nav class="sidebar" id="sidebar" aria-label="ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜">
        <div class="sidebar-header">
            <h2>ğŸŒ… ëª¨ë‹</h2>
            <button class="sidebar-close" id="sidebarClose" aria-label="ë©”ë‰´ ë‹«ê¸°">&times;</button>
        </div>
        
        <div class="sidebar-content">
            <div class="user-info" id="userInfo">
                <div class="user-greeting">ì•ˆë…•í•˜ì„¸ìš”!</div>
                <div class="user-streak">
                    <span class="streak-icon">ğŸ”¥</span>
                    <span id="streakNumber">0</span>ì¼ ì—°ì† ë°©ë¬¸
                </div>
                <div class="user-actions">
                    <button class="auth-btn" id="loginBtn" onclick="showAuthModal('login')">ë¡œê·¸ì¸</button>
                    <button class="auth-btn" id="logoutBtn" onclick="logout()" style="display: none;">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>

            <div class="menu-section">
                <h3>ğŸ“ ë©”ì‹œì§€</h3>
                <button class="menu-item" id="newQuoteBtn" data-action="newQuote">
                    <span class="menu-icon">ğŸŒ…</span>
                    ìƒˆë¡œìš´ ë©”ì‹œì§€
                </button>
                <button class="menu-item" id="favoritesBtn" data-action="favorites">
                    <span class="menu-icon">â­</span>
                    ì¦ê²¨ì°¾ê¸°
                </button>
                <button class="menu-item" id="historyBtn" data-action="history">
                    <span class="menu-icon">ğŸ“š</span>
                    íˆìŠ¤í† ë¦¬
                </button>
                <button class="menu-item" id="popularBtn" data-action="popular">
                    <span class="menu-icon">ğŸ”¥</span>
                    ì¸ê¸° ë©”ì‹œì§€
                </button>
            </div>

            <div class="menu-section">
                <h3>ğŸ“± ê¸°ëŠ¥</h3>
                <button class="menu-item" id="shareBtn" data-action="share">
                    <span class="menu-icon">ğŸ’Œ</span>
                    ê³µìœ í•˜ê¸°
                </button>
                <button class="menu-item" id="speakBtn" data-action="speak">
                    <span class="menu-icon">ğŸ”Š</span>
                    ìŒì„±ë“£ê¸°
                </button>
            </div>

            <div class="menu-section">
                <h3>ğŸŒ ì»¤ë®¤ë‹ˆí‹°</h3>
                <button class="menu-item" id="submitBtn" data-action="submit">
                    <span class="menu-icon">âœï¸</span>
                    ë©”ì‹œì§€ ì œì¶œ
                </button>
                <button class="menu-item" id="inviteBtn" data-action="invite">
                    <span class="menu-icon">ğŸ‘¥</span>
                    ì¹œêµ¬ ì´ˆëŒ€
                </button>
            </div>

            <div class="menu-section">
                <h3>âš™ï¸ ì„¤ì •</h3>
                <button class="menu-item" id="settingsBtn" data-action="settings">
                    <span class="menu-icon">âš™ï¸</span>
                    ì•± ì„¤ì •
                </button>
            </div>
        </div>
    </nav>

    <!-- ì‚¬ì´ë“œë°” ì˜¤ë²„ë ˆì´ -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="app-container">
        <!-- ê¹”ë”í•œ í—¤ë” -->
        <header class="header">
            <div class="time-greeting" id="timeGreeting"></div>
            <div class="header-indicators">
                <div class="seasonal-indicator" id="seasonalIndicator" title="í˜„ì¬ ê³„ì ˆ"></div>
                <div class="event-indicator" id="eventIndicator" title="í™œì„± ì´ë²¤íŠ¸" style="display: none;"></div>
            </div>
        </header>
        
        <!-- ë©”ì¸ ì½˜í…ì¸ : ê¸€ê·€ë§Œ í‘œì‹œ -->
        <main class="main-content" id="main-content">
            <div class="quote-container">
                <div class="quote-card" id="quoteCard">
                    <div class="loading" id="loading">
                        <div class="loading-spinner"></div>
                        <p>ìƒˆë¡œìš´ ë©”ì‹œì§€ë¥¼ ì¤€ë¹„í•˜ê³  ìˆì–´ìš”...</p>
                    </div>
                    <div class="quote-content" id="quoteContent" style="display: none;">
                        <div class="quote-actions">
                            <button class="favorite-btn" id="favoriteBtn" aria-label="ì¦ê²¨ì°¾ê¸° ì¶”ê°€/ì œê±°">
                                <span class="favorite-icon">ğŸ¤</span>
                            </button>
                        </div>
                        <blockquote class="quote-text" id="quoteText"></blockquote>
                        <div class="quote-category" id="quoteCategory"></div>
                        <div class="quote-reactions">
                            <button class="reaction-btn" id="likeBtn" data-reaction="like" aria-label="ì¢‹ì•„ìš”" onclick="handleReaction('like')">
                                <span class="reaction-icon">ğŸ‘</span>
                                <span class="reaction-count" id="likeCount">0</span>
                            </button>
                            <button class="reaction-btn" id="heartBtn" data-reaction="heart" aria-label="ê³µê°" onclick="handleReaction('heart')">
                                <span class="reaction-icon">â¤ï¸</span>
                                <span class="reaction-count" id="heartCount">0</span>
                            </button>
                            <button class="reaction-btn" id="fireBtn" data-reaction="fire" aria-label="í•«" onclick="handleReaction('fire')">
                                <span class="reaction-icon">ğŸ”¥</span>
                                <span class="reaction-count" id="fireCount">0</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- ê°„ë‹¨í•œ ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
                <div class="quick-actions">
                    <button class="quick-action-btn" id="quickNewBtn" aria-label="ìƒˆë¡œìš´ ë©”ì‹œì§€" title="ìƒˆë¡œìš´ ë©”ì‹œì§€">
                        ğŸ”„
                    </button>
                    <button class="quick-action-btn" id="quickShareBtn" aria-label="ê³µìœ í•˜ê¸°" title="ê³µìœ í•˜ê¸°">
                        ğŸ“¤
                    </button>
                    <button class="quick-action-btn" id="quickSpeakBtn" aria-label="ìŒì„±ë“£ê¸°" title="ìŒì„±ë“£ê¸°">
                        ğŸ”Š
                    </button>
                </div>
            </div>
        </main>
        
        <!-- ë¯¸ë‹ˆë©€ í‘¸í„° -->
        <footer class="footer">
            <div class="date-display" id="dateDisplay"></div>
            <div class="message-counter">
                <span id="messageCounter">1</span>ë²ˆì§¸ ë©”ì‹œì§€
            </div>
        </footer>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ í•„í„° ëª¨ë‹¬ -->
    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ·ï¸ ì¹´í…Œê³ ë¦¬ ì„ íƒ</h2>
                <button class="modal-close" id="categoryModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="category-grid">
                    <button class="category-btn active" data-category="all">
                        <span class="category-icon">ğŸŒŸ</span>
                        <span class="category-name">ëª¨ë“  ì¹´í…Œê³ ë¦¬</span>
                    </button>
                    <button class="category-btn" data-category="ìƒˆë¡œìš´ ì‹œì‘">
                        <span class="category-icon">ğŸŒ…</span>
                        <span class="category-name">ìƒˆë¡œìš´ ì‹œì‘</span>
                    </button>
                    <button class="category-btn" data-category="ë™ê¸°ë¶€ì—¬">
                        <span class="category-icon">ğŸ’ª</span>
                        <span class="category-name">ë™ê¸°ë¶€ì—¬</span>
                    </button>
                    <button class="category-btn" data-category="ê°ì‚¬">
                        <span class="category-icon">ğŸ™</span>
                        <span class="category-name">ê°ì‚¬</span>
                    </button>
                    <button class="category-btn" data-category="ìœ„ë¡œ">
                        <span class="category-icon">ğŸ¤—</span>
                        <span class="category-name">ìœ„ë¡œ</span>
                    </button>
                    <button class="category-btn" data-category="ì„±ì°°">
                        <span class="category-icon">ğŸ’­</span>
                        <span class="category-name">ì„±ì°°</span>
                    </button>
                    <button class="category-btn" data-category="í¬ë§">
                        <span class="category-icon">âœ¨</span>
                        <span class="category-name">í¬ë§</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ë©”ì‹œì§€ ê³µìœ í•˜ê¸°</h2>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="share-preview" id="sharePreview"></div>
                <div class="share-buttons">
                    <button class="share-btn" id="copyBtn">ğŸ“‹ í…ìŠ¤íŠ¸ ë³µì‚¬</button>
                    <button class="share-btn" id="kakaoBtn">ğŸ’¬ ì¹´ì¹´ì˜¤í†¡</button>
                    <button class="share-btn" id="twitterBtn">ğŸ¦ íŠ¸ìœ„í„°</button>
                    <button class="share-btn" id="facebookBtn">ğŸ“˜ í˜ì´ìŠ¤ë¶</button>
                    <button class="share-btn" id="webShareBtn" style="display: none;">ğŸ“± ë„¤ì´í‹°ë¸Œ ê³µìœ </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ì„¤ì • ëª¨ë‹¬ -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ ì„¤ì •</h2>
                <button class="modal-close" id="settingsModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="simple-settings">
                    <div class="setting-section">
                        <h3 class="setting-section-title">ğŸ‘¤ ê°œì¸í™”</h3>
                        <div class="setting-row">
                            <span>ğŸ“ ì´ë¦„</span>
                            <input type="text" id="userNameInput" class="text-input" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="10">
                        </div>
                        <div class="setting-row">
                            <span>ğŸ¨ í…Œë§ˆ</span>
                            <select id="themeSelect" class="theme-select">
                                <option value="default">ê¸°ë³¸</option>
                                <option value="spring">ğŸŒ¸ ë´„</option>
                                <option value="summer">â˜€ï¸ ì—¬ë¦„</option>
                                <option value="autumn">ğŸ‚ ê°€ì„</option>
                                <option value="winter">â„ï¸ ê²¨ìš¸</option>
                            </select>
                        </div>
                        <div class="setting-row">
                            <span>ğŸ“± í‘œì‹œ ë°©ì‹</span>
                            <select id="displayModeSelect" class="display-mode-select">
                                <option value="card">ì¹´ë“œí˜•</option>
                                <option value="minimal">ë¯¸ë‹ˆë©€</option>
                                <option value="typewriter">íƒ€ì´í•‘</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="setting-section">
                        <h3 class="setting-section-title">âš™ï¸ ê¸°ë³¸ ì„¤ì •</h3>
                        <div class="setting-row">
                            <span>ğŸŒ™ ë‹¤í¬ëª¨ë“œ</span>
                            <input type="checkbox" id="darkModeToggle" class="simple-toggle" aria-label="ë‹¤í¬ëª¨ë“œ í™œì„±í™”">
                        </div>
                        <div class="setting-row">
                            <span>ğŸ”” ì•Œë¦¼</span>
                            <input type="checkbox" id="notificationToggle" class="simple-toggle" aria-label="ì•Œë¦¼ í™œì„±í™”">
                        </div>
                        <div class="setting-row" id="notificationTimeRow" style="display: none;">
                            <span>â° ì•Œë¦¼ ì‹œê°„</span>
                            <input type="time" id="notificationTime" value="08:00" class="time-input">
                        </div>
                        <div class="setting-row">
                            <span>ğŸŒ¸ ê³„ì ˆë³„ ë©”ì‹œì§€</span>
                            <input type="checkbox" id="seasonalToggle" class="simple-toggle" aria-label="ê³„ì ˆë³„ ë©”ì‹œì§€ í™œì„±í™”">
                        </div>
                        <div class="setting-row">
                            <span>ğŸŠ íŠ¹ë³„í•œ ë‚  ë©”ì‹œì§€</span>
                            <input type="checkbox" id="specialDayToggle" class="simple-toggle" aria-label="íŠ¹ë³„í•œ ë‚  ë©”ì‹œì§€ í™œì„±í™”">
                        </div>
                        <div class="setting-row">
                            <span>ğŸ“… ì´ë²¤íŠ¸ ë©”ì‹œì§€</span>
                            <input type="checkbox" id="eventToggle" class="simple-toggle" aria-label="ì´ë²¤íŠ¸ ë©”ì‹œì§€ í™œì„±í™”">
                        </div>
                    </div>
                    
                    <div class="app-info">
                        <p>ë§¤ì¼ ìƒˆë¡œìš´ ë©”ì‹œì§€ë¡œ ì¢‹ì€ í•˜ë£¨ë¥¼ ì‹œì‘í•˜ì„¸ìš”</p>
                        <small>ë²„ì „ 4.0 - ì‚¬ìš©ì ì œì¶œ ì‹œìŠ¤í…œ</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ì¦ê²¨ì°¾ê¸° ëª¨ë‹¬ -->
    <div class="modal" id="favoritesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>â­ ì¦ê²¨ì°¾ê¸°</h2>
                <button class="modal-close" id="favoritesModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="favorites-container">
                    <div class="favorites-empty" id="favoritesEmpty" style="display: none;">
                        <p>ì•„ì§ ì¦ê²¨ì°¾ê¸°í•œ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <small>ë§ˆìŒì— ë“œëŠ” ë©”ì‹œì§€ì—ì„œ ğŸ¤ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!</small>
                    </div>
                    <div class="favorites-list" id="favoritesList"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- íˆìŠ¤í† ë¦¬ ëª¨ë‹¬ -->
    <div class="modal" id="historyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“š ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬</h2>
                <button class="modal-close" id="historyModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="history-container">
                    <div class="history-controls">
                        <div class="history-stats">
                            <span id="historyCount">0</span>ê°œì˜ ë©”ì‹œì§€ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤
                        </div>
                        <button class="clear-history-btn" id="clearHistoryBtn">ê¸°ë¡ ì‚­ì œ</button>
                    </div>
                    <div class="history-empty" id="historyEmpty" style="display: none;">
                        <p>ì•„ì§ í™•ì¸í•œ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <small>ë©”ì‹œì§€ë¥¼ ë³´ë©´ ì—¬ê¸°ì— ê¸°ë¡ë©ë‹ˆë‹¤!</small>
                    </div>
                    <div class="history-list" id="historyList"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ì¸ê¸° ë©”ì‹œì§€ ëª¨ë‹¬ -->
    <div class="modal" id="popularModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ”¥ ì˜¤ëŠ˜ì˜ ì¸ê¸° ë©”ì‹œì§€</h2>
                <button class="modal-close" id="popularModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="popular-container">
                    <div class="popular-info">
                        <p>ê°€ì¥ ë§ì€ ë°˜ì‘ì„ ë°›ì€ ë©”ì‹œì§€ë“¤ì…ë‹ˆë‹¤</p>
                    </div>
                    <div class="popular-empty" id="popularEmpty" style="display: none;">
                        <p>ì•„ì§ ì¸ê¸° ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <small>ë©”ì‹œì§€ì— ë°˜ì‘ì„ ë‚¨ê²¨ë³´ì„¸ìš”! ğŸ‘â¤ï¸ğŸ”¥</small>
                    </div>
                    <div class="popular-list" id="popularList"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ì¹œêµ¬ ì´ˆëŒ€ ëª¨ë‹¬ -->
    <div class="modal" id="inviteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ‘¥ ì¹œêµ¬ ì´ˆëŒ€í•˜ê¸°</h2>
                <button class="modal-close" id="inviteModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="invite-container">
                    <div class="invite-message">
                        <h3>ì¢‹ì€ ë©”ì‹œì§€ë¥¼ ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ë‚˜ëˆ ë³´ì„¸ìš”!</h3>
                        <p>ë§¤ì¼ ì•„ì¹¨ ë”°ëœ»í•œ ë©”ì‹œì§€ë¡œ í•˜ë£¨ë¥¼ ì‹œì‘í•˜ëŠ” ëª¨ë‹ ì•±ì„ ì¶”ì²œí•´ë³´ì„¸ìš”.</p>
                    </div>
                    <div class="invite-preview">
                        <div class="invite-text" id="inviteText">
                            "ë§¤ì¼ ì•„ì¹¨ ë”°ëœ»í•œ ë©”ì‹œì§€ë¡œ í•˜ë£¨ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”! ğŸŒ…
                            
ëª¨ë‹ ì•±ì—ì„œ ë‹¤ì–‘í•œ ëª…ì–¸ê³¼ ì¢‹ì€ ê¸€ê·€ë¥¼ ë§Œë‚˜ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ“± ì§€ê¸ˆ ë°”ë¡œ ì²´í—˜: {{APP_URL}}"
                        </div>
                    </div>
                    <div class="invite-buttons">
                        <button class="btn btn-primary" id="copyInviteBtn">ğŸ“‹ ì´ˆëŒ€ ë©”ì‹œì§€ ë³µì‚¬</button>
                        <button class="btn btn-secondary" id="shareInviteBtn">ğŸ“± ì•±ìœ¼ë¡œ ê³µìœ </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    
    <!-- ìŠµê´€ íŠ¸ë˜ì»¤ ëª¨ë‹¬ -->
    <div class="modal" id="habitModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“ˆ ìŠµê´€ íŠ¸ë˜ì»¤</h2>
                <button class="modal-close" id="habitModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="habit-container">
                    <div class="habit-stats">
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ”¥</div>
                            <div class="stat-info">
                                <div class="stat-number" id="currentStreak">0</div>
                                <div class="stat-label">ì—°ì† ë°©ë¬¸</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“…</div>
                            <div class="stat-info">
                                <div class="stat-number" id="totalDays">0</div>
                                <div class="stat-label">ì´ ë°©ë¬¸ì¼</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“</div>
                            <div class="stat-info">
                                <div class="stat-number" id="journalCount">0</div>
                                <div class="stat-label">ì‘ì„±í•œ ì¼ê¸°</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="habit-calendar">
                        <h3>ì´ë²ˆ ë‹¬ í™œë™</h3>
                        <div class="calendar-grid" id="calendarGrid"></div>
                        <div class="calendar-legend">
                            <div class="legend-item">
                                <div class="legend-color active"></div>
                                <span>í™œë™í•œ ë‚ </span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color inactive"></div>
                                <span>í™œë™í•˜ì§€ ì•Šì€ ë‚ </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    
    <!-- ì‚¬ìš©ì ì œì¶œ ëª¨ë‹¬ -->
    <div class="modal" id="submitModal">
        <div class="modal-content submit-modal-content">
            <div class="modal-header">
                <h2>âœï¸ ë©”ì‹œì§€ ì œì¶œí•˜ê¸°</h2>
                <button class="modal-close" id="submitModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="submit-container">
                    <div class="submit-tabs">
                        <button class="submit-tab active" data-tab="create">ìƒˆ ë©”ì‹œì§€</button>
                        <button class="submit-tab" data-tab="my-messages">ë‚´ ë©”ì‹œì§€</button>
                        <button class="submit-tab" data-tab="community">ì»¤ë®¤ë‹ˆí‹°</button>
                    </div>
                    
                    <!-- ìƒˆ ë©”ì‹œì§€ ì‘ì„± íƒ­ -->
                    <div class="submit-tab-content active" id="createTab">
                        <div class="submit-inspiration">
                            <div class="inspiration-text">
                                "ë‹¹ì‹ ì˜ ë”°ëœ»í•œ ë©”ì‹œì§€ê°€ ë‹¤ë¥¸ ì‚¬ëŒì˜ í•˜ë£¨ë¥¼ ë°í ìˆ˜ ìˆìŠµë‹ˆë‹¤" ğŸ’«
                            </div>
                        </div>
                        
                        <div class="message-form">
                            <div class="form-group">
                                <label for="messageText">ë©”ì‹œì§€ ë‚´ìš©</label>
                                <textarea 
                                    id="messageText" 
                                    class="message-textarea" 
                                    placeholder="ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ í˜ì´ ë˜ëŠ” ë”°ëœ»í•œ ë©”ì‹œì§€ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”...&#10;&#10;ì˜ˆì‹œ:&#10;- ì˜¤ëŠ˜ë„ ìµœì„ ì„ ë‹¤í•˜ëŠ” ë‹¹ì‹ ì´ ìë‘ìŠ¤ëŸ½ìŠµë‹ˆë‹¤&#10;- ì‘ì€ ê±¸ìŒë„ ì•ìœ¼ë¡œ ë‚˜ì•„ê°€ëŠ” ê²ƒì…ë‹ˆë‹¤&#10;- ë‹¹ì‹ ì˜ ì¡´ì¬ë§Œìœ¼ë¡œë„ ì„¸ìƒì´ ë” ë°ì•„ì§‘ë‹ˆë‹¤"
                                    rows="6"
                                    maxlength="200"></textarea>
                                <div class="char-counter">
                                    <span id="messageCharCount">0</span> / 200
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group half">
                                    <label for="messageAuthor">ì‘ì„±ì</label>
                                    <input type="text" id="messageAuthor" placeholder="ìµëª…" maxlength="20">
                                </div>
                                <div class="form-group half">
                                    <label for="messageCategory">ì¹´í…Œê³ ë¦¬</label>
                                    <select id="messageCategory">
                                        <option value="ë™ê¸°ë¶€ì—¬">ğŸ’ª ë™ê¸°ë¶€ì—¬</option>
                                        <option value="ìœ„ë¡œ">ğŸ¤— ìœ„ë¡œ</option>
                                        <option value="ê°ì‚¬">ğŸ™ ê°ì‚¬</option>
                                        <option value="í¬ë§">âœ¨ í¬ë§</option>
                                        <option value="ì„±ì¥">ğŸŒ± ì„±ì¥</option>
                                        <option value="ê¸ì •">ğŸ˜Š ê¸ì •</option>
                                        <option value="ì‚¬ë‘">â¤ï¸ ì‚¬ë‘</option>
                                        <option value="ìš©ê¸°">ğŸ’ª ìš©ê¸°</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group half">
                                    <label for="messageTimeOfDay">ì‹œê°„ëŒ€</label>
                                    <select id="messageTimeOfDay">
                                        <option value="">ì–¸ì œë‚˜</option>
                                        <option value="morning">ğŸŒ… ì•„ì¹¨</option>
                                        <option value="afternoon">â˜€ï¸ ì˜¤í›„</option>
                                        <option value="evening">ğŸŒ† ì €ë…</option>
                                        <option value="night">ğŸŒ™ ë°¤</option>
                                    </select>
                                </div>
                                <div class="form-group half">
                                    <label for="messageSeason">ê³„ì ˆ</label>
                                    <select id="messageSeason">
                                        <option value="all">ëª¨ë“  ê³„ì ˆ</option>
                                        <option value="spring">ğŸŒ¸ ë´„</option>
                                        <option value="summer">â˜€ï¸ ì—¬ë¦„</option>
                                        <option value="autumn">ğŸ‚ ê°€ì„</option>
                                        <option value="winter">â„ï¸ ê²¨ìš¸</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="submit-actions">
                                <button class="btn btn-secondary" id="previewMessageBtn">ë¯¸ë¦¬ë³´ê¸°</button>
                                <button class="btn btn-primary" id="submitMessageBtn">ì œì¶œí•˜ê¸°</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ë‚´ ë©”ì‹œì§€ íƒ­ -->
                    <div class="submit-tab-content" id="myMessagesTab">
                        <div class="my-messages-header">
                            <h3>ğŸ“ ë‚´ê°€ ì‘ì„±í•œ ë©”ì‹œì§€</h3>
                            <div class="my-messages-stats">
                                <span id="myMessagesCount">0</span>ê°œì˜ ë©”ì‹œì§€ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤
                            </div>
                        </div>
                        
                        <div class="my-messages-empty" id="myMessagesEmpty" style="display: none;">
                            <p>ì•„ì§ ì‘ì„±í•œ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                            <small>ìƒˆ ë©”ì‹œì§€ íƒ­ì—ì„œ ì²« ë²ˆì§¸ ë©”ì‹œì§€ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”! âœï¸</small>
                        </div>
                        
                        <div class="my-messages-list" id="myMessagesList"></div>
                    </div>
                    
                    <!-- ì»¤ë®¤ë‹ˆí‹° íƒ­ -->
                    <div class="submit-tab-content" id="communityTab">
                        <div class="community-header">
                            <h3>ğŸŒ ì»¤ë®¤ë‹ˆí‹° ë©”ì‹œì§€</h3>
                            <div class="community-stats">
                                <span id="communityCount">0</span>ê°œì˜ ì»¤ë®¤ë‹ˆí‹° ë©”ì‹œì§€
                            </div>
                        </div>
                        
                        <div class="community-filters">
                            <select id="communityFilter">
                                <option value="all">ì „ì²´ ë³´ê¸°</option>
                                <option value="recent">ìµœì‹ ìˆœ</option>
                                <option value="popular">ì¸ê¸°ìˆœ</option>
                                <option value="my-category">ë‚´ ê´€ì‹¬ ì¹´í…Œê³ ë¦¬</option>
                            </select>
                        </div>
                        
                        <div class="community-empty" id="communityEmpty" style="display: none;">
                            <p>ì»¤ë®¤ë‹ˆí‹° ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                            <small>ì²« ë²ˆì§¸ ë©”ì‹œì§€ë¥¼ ì‘ì„±í•´ì„œ ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”! ğŸŒŸ</small>
                        </div>
                        
                        <div class="community-list" id="communityList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ì¸ì¦ ëª¨ë‹¬ (ë¡œê·¸ì¸/íšŒì›ê°€ì…) -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="authModalTitle">ë¡œê·¸ì¸</h2>
                <button class="modal-close" data-modal="authModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchAuthTab('login')">ë¡œê·¸ì¸</button>
                    <button class="auth-tab" onclick="switchAuthTab('register')">íšŒì›ê°€ì…</button>
                </div>
                
                <!-- ë¡œê·¸ì¸ í¼ -->
                <form id="loginForm" class="auth-form">
                    <div class="form-group">
                        <label for="loginUsername">ì‚¬ìš©ìëª…</label>
                        <input type="text" id="loginUsername" required minlength="3" maxlength="50">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="loginPassword" required minlength="6">
                    </div>
                    <button type="submit" class="btn-primary">ë¡œê·¸ì¸</button>
                </form>
                
                <!-- íšŒì›ê°€ì… í¼ -->
                <form id="registerForm" class="auth-form" style="display: none;">
                    <div class="form-group">
                        <label for="registerUsername">ì‚¬ìš©ìëª…</label>
                        <input type="text" id="registerUsername" required minlength="3" maxlength="50">
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">ì´ë©”ì¼ (ì„ íƒì‚¬í•­)</label>
                        <input type="email" id="registerEmail">
                    </div>
                    <div class="form-group">
                        <label for="registerDisplayName">í‘œì‹œ ì´ë¦„</label>
                        <input type="text" id="registerDisplayName" maxlength="100">
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="registerPassword" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="registerPasswordConfirm">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                        <input type="password" id="registerPasswordConfirm" required minlength="6">
                    </div>
                    <button type="submit" class="btn-primary">íšŒì›ê°€ì…</button>
                </form>
                
                <div id="authMessage" class="auth-message"></div>
            </div>
        </div>
    </div>

    <!-- ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
    <div class="modal" id="previewModal">
        <div class="modal-content preview-modal-content">
            <div class="modal-header">
                <h2>ğŸ‘€ ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°</h2>
                <button class="modal-close" id="previewModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="preview-container">
                    <div class="preview-quote-card">
                        <blockquote class="preview-quote-text" id="previewText"></blockquote>
                        <cite class="preview-quote-author" id="previewAuthor"></cite>
                        <div class="preview-quote-category" id="previewCategory"></div>
                        <div class="preview-quote-meta">
                            <span id="previewTimeOfDay"></span>
                            <span id="previewSeason"></span>
                        </div>
                    </div>
                    
                    <div class="preview-actions">
                        <button class="btn btn-secondary" id="editMessageBtn">ìˆ˜ì •í•˜ê¸°</button>
                        <button class="btn btn-primary" id="confirmSubmitBtn">ì œì¶œ í™•ì •</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

 
    
    <!-- ì¹´ì¹´ì˜¤ SDK -->
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js" 
            integrity="sha384-TiCUE00h649CAMonG018J2ujOgDKW/kVWlChEuu4jK2vxfAAD0eZxzCKakxg55G4" 
            crossorigin="anonymous"></script>
    
    <!-- ì›ë³¸ script.js ëŒ€ì‹  ì•ˆì „í•œ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        console.log('ì•ˆì „í•œ ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘...');

        // API ì„¤ì •
        const API_BASE_URL = 'http://localhost:8002';
        let currentUser = null;
        let authToken = null;

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í† í° í™•ì¸
        function loadUserSession() {
            const token = localStorage.getItem('authToken');
            const user = localStorage.getItem('currentUser');
            if (token && user) {
                authToken = token;
                currentUser = JSON.parse(user);
                updateUserInterface();
            }
        }

        // ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ì—…ë°ì´íŠ¸
        function updateUserInterface() {
            const userInfo = safeGetElement('userInfo');
            if (userInfo && currentUser) {
                const greeting = userInfo.querySelector('.user-greeting');
                if (greeting) {
                    greeting.textContent = `ì•ˆë…•í•˜ì„¸ìš”, ${currentUser.display_name || currentUser.username}ë‹˜!`;
                }
            }
        }

        // API í˜¸ì¶œ í—¬í¼ í•¨ìˆ˜
        async function apiCall(endpoint, options = {}) {
            const url = `${API_BASE_URL}${endpoint}`;
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };
            
            if (authToken) {
                headers['Authorization'] = `Bearer ${authToken}`;
            }
            
            const response = await fetch(url, {
                ...options,
                headers
            });
            
            if (!response.ok) {
                throw new Error(`API Error: ${response.status}`);
            }
            
            return response.json();
        }

        // íšŒì›ê°€ì…
        async function register(username, email, password, displayName) {
            try {
                const response = await apiCall('/auth/register', {
                    method: 'POST',
                    body: JSON.stringify({
                        username,
                        email,
                        password,
                        display_name: displayName
                    })
                });
                
                authToken = response.access_token;
                currentUser = response.user;
                
                localStorage.setItem('authToken', authToken);
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                updateUserInterface();
                return response;
            } catch (error) {
                console.error('íšŒì›ê°€ì… ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // ë¡œê·¸ì¸
        async function login(username, password) {
            try {
                const response = await apiCall('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({
                        username,
                        password
                    })
                });
                
                authToken = response.access_token;
                currentUser = response.user;
                
                localStorage.setItem('authToken', authToken);
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                updateUserInterface();
                return response;
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            authToken = null;
            currentUser = null;
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            updateUserInterface();
        }

        // ë¡œì»¬ ì¦ê²¨ì°¾ê¸° ê´€ë¦¬
        let localFavorites = [];

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì¦ê²¨ì°¾ê¸° ë¡œë“œ
        function loadLocalFavorites() {
            try {
                const saved = localStorage.getItem('favorites');
                localFavorites = saved ? JSON.parse(saved) : [];
                console.log(`${localFavorites.length}ê°œì˜ ì¦ê²¨ì°¾ê¸°ë¥¼ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.`);
            } catch (error) {
                console.error('ì¦ê²¨ì°¾ê¸° ë¡œë“œ ì‹¤íŒ¨:', error);
                localFavorites = [];
            }
        }

        // ì¦ê²¨ì°¾ê¸° ì €ì¥
        function saveLocalFavorites() {
            try {
                localStorage.setItem('favorites', JSON.stringify(localFavorites));
            } catch (error) {
                console.error('ì¦ê²¨ì°¾ê¸° ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        // ì¦ê²¨ì°¾ê¸° ì¶”ê°€
        function addFavorite(messageId, messageData) {
            try {
                // ì¤‘ë³µ í™•ì¸
                const existingIndex = localFavorites.findIndex(fav => fav.message_id === messageId);
                if (existingIndex >= 0) {
                    console.log('ì´ë¯¸ ì¦ê²¨ì°¾ê¸°ì— ìˆëŠ” ë©”ì‹œì§€ì…ë‹ˆë‹¤.');
                    return false;
                }

                // ìƒˆ ì¦ê²¨ì°¾ê¸° ì¶”ê°€
                const newFavorite = {
                    id: Date.now().toString(),
                    message_id: messageId,
                    message_data: messageData,
                    added_at: new Date().toISOString()
                };

                localFavorites.unshift(newFavorite);
                saveLocalFavorites();
                console.log('ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                return true;
            } catch (error) {
                console.error('ì¦ê²¨ì°¾ê¸° ì¶”ê°€ ì˜¤ë¥˜:', error);
                return false;
            }
        }

        // ì¦ê²¨ì°¾ê¸° ì œê±°
        function removeFavorite(messageId) {
            try {
                const originalLength = localFavorites.length;
                localFavorites = localFavorites.filter(fav => fav.message_id !== messageId);
                
                if (localFavorites.length < originalLength) {
                    saveLocalFavorites();
                    console.log('ì¦ê²¨ì°¾ê¸°ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    return true;
                }
                return false;
            } catch (error) {
                console.error('ì¦ê²¨ì°¾ê¸° ì œê±° ì˜¤ë¥˜:', error);
                return false;
            }
        }

        // ì¦ê²¨ì°¾ê¸° ëª©ë¡ ì¡°íšŒ
        function getFavorites() {
            return localFavorites;
        }

        // ì¦ê²¨ì°¾ê¸° ì—¬ë¶€ í™•ì¸
        function isFavorite(messageId) {
            return localFavorites.some(fav => fav.message_id === messageId);
        }

        // ì¸ì¦ ëª¨ë‹¬ í‘œì‹œ
        function showAuthModal(type = 'login') {
            const modal = safeGetElement('authModal');
            if (modal) {
                modal.style.display = 'block';
                switchAuthTab(type);
            }
        }

        // ì¸ì¦ íƒ­ ì „í™˜
        function switchAuthTab(type) {
            const loginForm = safeGetElement('loginForm');
            const registerForm = safeGetElement('registerForm');
            const authModalTitle = safeGetElement('authModalTitle');
            const tabs = document.querySelectorAll('.auth-tab');
            
            // íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            tabs.forEach(tab => tab.classList.remove('active'));
            document.querySelector(`.auth-tab[onclick*="${type}"]`).classList.add('active');
            
            if (type === 'login') {
                if (loginForm) loginForm.style.display = 'block';
                if (registerForm) registerForm.style.display = 'none';
                if (authModalTitle) authModalTitle.textContent = 'ë¡œê·¸ì¸';
            } else {
                if (loginForm) loginForm.style.display = 'none';
                if (registerForm) registerForm.style.display = 'block';
                if (authModalTitle) authModalTitle.textContent = 'íšŒì›ê°€ì…';
            }
            
            // ë©”ì‹œì§€ ì´ˆê¸°í™”
            const authMessage = safeGetElement('authMessage');
            if (authMessage) authMessage.textContent = '';
        }

        // ì¸ì¦ ë©”ì‹œì§€ í‘œì‹œ
        function showAuthMessage(message, isError = false) {
            const authMessage = safeGetElement('authMessage');
            if (authMessage) {
                authMessage.textContent = message;
                authMessage.style.color = isError ? '#e74c3c' : '#27ae60';
            }
        }

        // ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ì—…ë°ì´íŠ¸ (ë¡œê·¸ì¸ ìƒíƒœ ë°˜ì˜)
        function updateUserInterface() {
            const userInfo = safeGetElement('userInfo');
            const loginBtn = safeGetElement('loginBtn');
            const logoutBtn = safeGetElement('logoutBtn');
            
            if (currentUser) {
                // ë¡œê·¸ì¸ ìƒíƒœ
                if (userInfo) {
                    const greeting = userInfo.querySelector('.user-greeting');
                    if (greeting) {
                        greeting.textContent = `ì•ˆë…•í•˜ì„¸ìš”, ${currentUser.display_name || currentUser.username}ë‹˜!`;
                    }
                }
                if (loginBtn) loginBtn.style.display = 'none';
                if (logoutBtn) logoutBtn.style.display = 'block';
            } else {
                // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ
                if (userInfo) {
                    const greeting = userInfo.querySelector('.user-greeting');
                    if (greeting) {
                        greeting.textContent = 'ì•ˆë…•í•˜ì„¸ìš”!';
                    }
                }
                if (loginBtn) loginBtn.style.display = 'block';
                if (logoutBtn) logoutBtn.style.display = 'none';
            }
        }


        // íˆìŠ¤í† ë¦¬ ëª¨ë‹¬ í‘œì‹œ  
        function showHistoryModal() {
            const modal = safeGetElement('historyModal');
            const historyContent = modal?.querySelector('.modal-body');
            
            if (!modal || !historyContent) {
                alert('íˆìŠ¤í† ë¦¬ ëª¨ë‹¬ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (messageHistory.length === 0) {
                historyContent.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6b7280;">
                        <p>ì•„ì§ ë³¸ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p>ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ë©´ ì—¬ê¸°ì— ê¸°ë¡ë©ë‹ˆë‹¤.</p>
                    </div>
                `;
            } else {
                const historyHtml = messageHistory.map((msg, index) => `
                    <div class="history-item" style="margin-bottom: 1rem; padding: 1rem; border: 1px solid #e5e7eb; border-radius: 8px; cursor: pointer;" 
                         onclick="showHistoryMessage(${index})">
                        <div style="font-size: 0.9rem; color: #374151; margin-bottom: 0.5rem;">
                            ${msg.text.length > 80 ? msg.text.substring(0, 80) + '...' : msg.text}
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.8rem; color: #6b7280;">#${msg.category}</span>
                            <span style="font-size: 0.75rem; color: #9ca3af;">
                                ${new Date(msg.viewedAt).toLocaleDateString('ko-KR')}
                            </span>
                        </div>
                    </div>
                `).join('');
                
                historyContent.innerHTML = `
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${historyHtml}
                    </div>
                `;
            }
            
            modal.style.display = 'block';
        }

        // íˆìŠ¤í† ë¦¬ì—ì„œ ë©”ì‹œì§€ ì„ íƒ
        function showHistoryMessage(index) {
            const message = messageHistory[index];
            if (message) {
                // í˜„ì¬ ë©”ì‹œì§€ ë°°ì—´ì—ì„œ í•´ë‹¹ ë©”ì‹œì§€ ì°¾ê¸°
                const messageIndex = messages.findIndex(msg => msg.id === message.id);
                if (messageIndex >= 0) {
                    showMessage(messageIndex, false);
                }
                const modal = safeGetElement('historyModal');
                if (modal) modal.style.display = 'none';
            }
        }


        // ì¦ê²¨ì°¾ê¸° ëª¨ë‹¬ í‘œì‹œ
        function showFavoritesModal() {
            const modal = safeGetElement('favoritesModal');
            const favoritesContent = modal?.querySelector('.modal-body');
            
            if (!modal || !favoritesContent) {
                alert('ì¦ê²¨ì°¾ê¸° ëª¨ë‹¬ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const favorites = getFavorites();
            
            if (favorites.length === 0) {
                favoritesContent.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6b7280;">
                        <p>ì•„ì§ ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€ëœ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p>ë§ˆìŒì— ë“œëŠ” ë©”ì‹œì§€ë¥¼ â¤ï¸ ë²„íŠ¼ìœ¼ë¡œ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
                    </div>
                `;
            } else {
                const favoritesHtml = favorites.map((fav, index) => `
                    <div class="favorite-item" style="margin-bottom: 1rem; padding: 1rem; border: 1px solid #e5e7eb; border-radius: 8px; position: relative;">
                        <button onclick="removeFavoriteFromModal('${fav.message_id}', ${index})" 
                                style="position: absolute; top: 0.5rem; right: 0.5rem; background: none; border: none; font-size: 1.2rem; cursor: pointer; color: #ef4444;" 
                                title="ì¦ê²¨ì°¾ê¸°ì—ì„œ ì œê±°">
                            Ã—
                        </button>
                        <blockquote style="margin: 0 0 0.5rem 0; font-style: italic; color: #374151;">
                            "${fav.message_data.text}"
                        </blockquote>
                        <div style="margin-top: 0.5rem;">
                            <span style="background: #f3f4f6; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; color: #6b7280;">
                                #${fav.message_data.category}
                            </span>
                            <span style="margin-left: 0.5rem; font-size: 0.8rem; color: #9ca3af;">
                                ${new Date(fav.added_at).toLocaleDateString('ko-KR')}
                            </span>
                        </div>
                    </div>
                `).join('');
                
                favoritesContent.innerHTML = `
                    <div style="max-height: 400px; overflow-y: auto;">
                        <div style="margin-bottom: 1rem; text-align: center; color: #6b7280; font-size: 0.9rem;">
                            ì´ ${favorites.length}ê°œì˜ ì¦ê²¨ì°¾ê¸°
                        </div>
                        ${favoritesHtml}
                    </div>
                `;
            }
            
            modal.style.display = 'block';
        }

        // ì¦ê²¨ì°¾ê¸° ëª¨ë‹¬ì—ì„œ ì œê±°
        function removeFavoriteFromModal(messageId, index) {
            const success = removeFavorite(messageId);
            if (success) {
                showFavoritesModal(); // ëª¨ë‹¬ ìƒˆë¡œê³ ì¹¨
                
                // í˜„ì¬ í‘œì‹œëœ ë©”ì‹œì§€ê°€ ì œê±°ëœ ë©”ì‹œì§€ì¸ ê²½ìš° í•˜íŠ¸ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
                const currentMessage = messages[currentMessageIndex];
                if (currentMessage && `msg_${currentMessage.id || currentMessageIndex}` === messageId) {
                    const favoriteIcon = document.querySelector('.favorite-icon');
                    if (favoriteIcon) {
                        favoriteIcon.textContent = 'ğŸ¤';
                    }
                }
            }
        }

        // ë©”ì‹œì§€ ë°ì´í„°
        let messages = [];
        let allMessages = []; // ì „ì²´ ë©”ì‹œì§€ ì €ì¥ìš©
        
        // ê¸°ë³¸ ë©”ì‹œì§€ (JSON ë¡œë“œ ì‹¤íŒ¨ì‹œ ë°±ì—…ìš©) - í™•ì¥ëœ ë©”ì‹œì§€ ëª¨ìŒ
        const fallbackMessages = [
            // ë™ê¸°ë¶€ì—¬
            { id: 1, text: "ìƒˆë¡œìš´ í•˜ë£¨ê°€ ì‹œì‘ë©ë‹ˆë‹¤. ì˜¤ëŠ˜ë„ ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”! ğŸŒ…", category: "ìƒˆë¡œìš´ ì‹œì‘", timeOfDay: "morning", season: "all" },
            { id: 2, text: "ì‘ì€ ê±¸ìŒë„ ì•ìœ¼ë¡œ ë‚˜ì•„ê°€ëŠ” ê²ƒì…ë‹ˆë‹¤.", category: "ë™ê¸°ë¶€ì—¬", timeOfDay: "morning", season: "all" },
            { id: 3, text: "ì˜¤ëŠ˜ í•˜ë£¨ë„ ê°ì‚¬í•œ ë§ˆìŒìœ¼ë¡œ ì‹œì‘í•´ë³´ì„¸ìš”.", category: "ê°ì‚¬", timeOfDay: "morning", season: "all" },
            { id: 4, text: "ë‹¹ì‹ ì˜ ê¿ˆì€ ì¶©ë¶„íˆ ê°€ì¹˜ê°€ ìˆìŠµë‹ˆë‹¤.", category: "ê¿ˆ", timeOfDay: "all", season: "all" },
            { id: 5, text: "ì§€ê¸ˆ ì´ ìˆœê°„ì´ ìƒˆë¡œìš´ ì‹œì‘ì˜ ê¸°íšŒì…ë‹ˆë‹¤.", category: "ê¸°íšŒ", timeOfDay: "all", season: "all" },
            
            // ëª…ì–¸
            { id: 6, text: "í–‰ë³µì€ ìŠµê´€ì´ë‹¤. ê·¸ê²ƒì„ ëª¸ì— ì§€ë‹ˆë¼.", category: "í–‰ë³µ", timeOfDay: "all", season: "all" },
            { id: 7, text: "ì„±ê³µì€ ì¤€ë¹„ì™€ ê¸°íšŒê°€ ë§Œë‚˜ëŠ” ì§€ì ì´ë‹¤.", category: "ì„±ê³µ", timeOfDay: "all", season: "all" },
            { id: 8, text: "ê°€ì¥ ì–´ë‘ìš´ ë°¤ì´ ì§€ë‚˜ë©´ ê°€ì¥ ì•„ë¦„ë‹¤ìš´ ìƒˆë²½ì´ ì˜¨ë‹¤.", category: "í¬ë§", timeOfDay: "morning", season: "all" },
            { id: 9, text: "ì˜¤ëŠ˜ í•  ìˆ˜ ìˆëŠ” ì¼ì„ ë‚´ì¼ë¡œ ë¯¸ë£¨ì§€ ë§ˆë¼.", category: "ì‹¤í–‰ë ¥", timeOfDay: "all", season: "all" },
            { id: 10, text: "ë³€í™”ë¥¼ ë‘ë ¤ì›Œí•˜ì§€ ë§ˆë¼. ë³€í™”ëŠ” ì„±ì¥ì˜ ì‹œì‘ì´ë‹¤.", category: "ë³€í™”", timeOfDay: "all", season: "all" },
            
            // ìœ„ë¡œì™€ ê²©ë ¤
            { id: 11, text: "ëª¨ë“  ì¼ì´ ì˜ ë  ê±°ì•¼. ê±±ì •í•˜ì§€ ë§ˆì„¸ìš”.", category: "ìœ„ë¡œ", timeOfDay: "all", season: "all" },
            { id: 12, text: "ì‹¤íŒ¨ëŠ” ì„±ê³µìœ¼ë¡œ ê°€ëŠ” ì§•ê²€ë‹¤ë¦¬ì…ë‹ˆë‹¤.", category: "ê²©ë ¤", timeOfDay: "all", season: "all" },
            { id: 13, text: "í˜ë“  ì‹œê°„ë„ ì§€ë‚˜ê°‘ë‹ˆë‹¤. ì¡°ê¸ˆë§Œ ë” ë²„í…¨ìš”.", category: "ìœ„ë¡œ", timeOfDay: "all", season: "all" },
            { id: 14, text: "ë‹¹ì‹ ì€ ìƒê°ë³´ë‹¤ í›¨ì”¬ ê°•í•œ ì‚¬ëŒì…ë‹ˆë‹¤.", category: "ê²©ë ¤", timeOfDay: "all", season: "all" },
            { id: 15, text: "ì˜¤ëŠ˜ë„ ìµœì„ ì„ ë‹¤í•œ ë‹¹ì‹ ì—ê²Œ ë°•ìˆ˜ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.", category: "ê²©ë ¤", timeOfDay: "evening", season: "all" },
            
            // ê¸ì •ê³¼ ì—ë„ˆì§€
            { id: 16, text: "ì›ƒìŒì€ ë§ˆìŒì˜ íŠ¹íš¨ì•½ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ ë§ì´ ì›ƒìœ¼ì„¸ìš”! ğŸ˜Š", category: "ê¸ì •", timeOfDay: "all", season: "all" },
            { id: 17, text: "ì¢‹ì€ ì¼ì´ ìƒê¸¸ ê²ƒ ê°™ì€ ê¸°ë¶„ì´ ë“­ë‹ˆë‹¤.", category: "ê¸ì •", timeOfDay: "morning", season: "all" },
            { id: 18, text: "ì—ë„ˆì§€ ë„˜ì¹˜ëŠ” í•˜ë£¨ë¥¼ ë§Œë“¤ì–´ ë³´ì„¸ìš”!", category: "ì—ë„ˆì§€", timeOfDay: "morning", season: "all" },
            { id: 19, text: "ê¸ì •ì ì¸ ë§ˆìŒê°€ì§ì´ ê¸°ì ì„ ë§Œë“­ë‹ˆë‹¤.", category: "ê¸ì •", timeOfDay: "all", season: "all" },
            { id: 20, text: "ì˜¤ëŠ˜ì€ íŠ¹ë³„í•œ ë‚ ì´ ë  ê²ƒì…ë‹ˆë‹¤.", category: "ê¸°ëŒ€", timeOfDay: "morning", season: "all" },
            
            // ì§€í˜œì™€ ì„±ì°°
            { id: 21, text: "ì§„ì •í•œ ì§€í˜œëŠ” ìì‹ ì˜ ë¬´ì§€ë¥¼ ì•„ëŠ” ê²ƒì´ë‹¤.", category: "ì§€í˜œ", timeOfDay: "all", season: "all" },
            { id: 22, text: "ê³¼ê±°ì— ì—°ì—°í•˜ì§€ ë§ê³  í˜„ì¬ì— ì§‘ì¤‘í•˜ì„¸ìš”.", category: "í˜„ì¬", timeOfDay: "all", season: "all" },
            { id: 23, text: "ë°°ì›€ì—ëŠ” ëì´ ì—†ìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ë„ ìƒˆë¡œìš´ ê²ƒì„ ë°°ì›Œë³´ì„¸ìš”.", category: "í•™ìŠµ", timeOfDay: "all", season: "all" },
            { id: 24, text: "ê°ì‚¬í•œ ë§ˆìŒì€ ë” ë§ì€ í–‰ë³µì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.", category: "ê°ì‚¬", timeOfDay: "all", season: "all" },
            { id: 25, text: "ì¸ìƒì€ ë§ˆë¼í†¤ì…ë‹ˆë‹¤. ìì‹ ì˜ í˜ì´ìŠ¤ë¥¼ ìœ ì§€í•˜ì„¸ìš”.", category: "ì¸ìƒ", timeOfDay: "all", season: "all" },
            
            // ê´€ê³„ì™€ ì‚¬ë‘
            { id: 26, text: "ì‚¬ë‘í•˜ëŠ” ì‚¬ëŒë“¤ì—ê²Œ ë”°ëœ»í•œ ë§ í•œë§ˆë”” ê±´ë„¤ë³´ì„¸ìš”.", category: "ì‚¬ë‘", timeOfDay: "all", season: "all" },
            { id: 27, text: "í˜¼ìê°€ ì•„ë‹™ë‹ˆë‹¤. ë‹¹ì‹ ì„ ì•„ë¼ëŠ” ì‚¬ëŒë“¤ì´ ìˆì–´ìš”.", category: "ìœ„ë¡œ", timeOfDay: "all", season: "all" },
            { id: 28, text: "ì§„ì‹¬ ì–´ë¦° í•œë§ˆë””ê°€ ëˆ„êµ°ê°€ì˜ í•˜ë£¨ë¥¼ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.", category: "ê´€ê³„", timeOfDay: "all", season: "all" },
            { id: 29, text: "ìš©ì„œëŠ” ìì‹ ì„ ìœ„í•œ ì„ ë¬¼ì…ë‹ˆë‹¤.", category: "ìš©ì„œ", timeOfDay: "all", season: "all" },
            { id: 30, text: "ì†Œì¤‘í•œ ì‚¬ëŒë“¤ê³¼ í•¨ê»˜í•˜ëŠ” ì‹œê°„ì„ ë” ë§ì´ ë§Œë“œì„¸ìš”.", category: "ê´€ê³„", timeOfDay: "all", season: "all" }
        ];

        // ë©”ì‹œì§€ ë°ì´í„° ë¡œë“œ
        async function loadMessages() {
            try {
                // 1. ë¡œì»¬ messages.json ë¡œë“œ ì‹œë„
                let localMessages = [];
                try {
                    const response = await fetch('./messages.json');
                    const data = await response.json();
                    localMessages = data.messages || [];
                    console.log(`ë¡œì»¬ì—ì„œ ${localMessages.length}ê°œì˜ ë©”ì‹œì§€ë¥¼ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.`);
                } catch (error) {
                    console.log('ë¡œì»¬ ë©”ì‹œì§€ ë¡œë“œ ì‹¤íŒ¨, ê¸°ë³¸ ë©”ì‹œì§€ ì‚¬ìš©');
                    localMessages = fallbackMessages;
                }

                // 2. ìºì‹œëœ ë©”ì‹œì§€ ë¡œë“œ
                const cachedMessages = messageUpdater.loadCachedMessages();
                if (cachedMessages.length > 0) {
                    console.log(`ìºì‹œì—ì„œ ${cachedMessages.length}ê°œì˜ ë©”ì‹œì§€ë¥¼ ì¶”ê°€ë¡œ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.`);
                }

                // 3. ì™¸ë¶€ ëª…ì–¸ APIì—ì„œ ì¶”ê°€ ë©”ì‹œì§€ ë¡œë“œ ì‹œë„
                const externalMessages = await loadExternalQuotes();
                
                // 4. ëª¨ë“  ë©”ì‹œì§€ í•©ì¹˜ê¸°
                allMessages = [...localMessages, ...cachedMessages, ...externalMessages];
                messages = [...allMessages];
                
                console.log(`ì´ ${messages.length}ê°œì˜ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);

                // 5. ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì—…ë°ì´íŠ¸ í™•ì¸ (ë¹„ë™ê¸°)
                setTimeout(async () => {
                    try {
                        await messageUpdater.checkForUpdates();
                    } catch (error) {
                        console.log('ë°±ê·¸ë¼ìš´ë“œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                    }
                }, 2000); // 2ì´ˆ í›„ ì‹¤í–‰

                return true;
            } catch (error) {
                console.error('ë©”ì‹œì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
                allMessages = fallbackMessages;
                messages = [...fallbackMessages];
                return false;
            }
        }

        // ì™¸ë¶€ ëª…ì–¸ APIì—ì„œ ë©”ì‹œì§€ ë¡œë“œ
        async function loadExternalQuotes() {
            const externalMessages = [];
            
            try {
                // í•œêµ­ì–´ ëª…ì–¸ API ì‹œë„ (ê°€ìƒì˜ ì˜ˆì‹œ - ì‹¤ì œë¡œëŠ” ì¡´ì¬í•˜ëŠ” API ì‚¬ìš©)
                const koreanQuotes = await fetchKoreanQuotes();
                externalMessages.push(...koreanQuotes);
            } catch (error) {
                console.log('í•œêµ­ì–´ ëª…ì–¸ API ë¡œë“œ ì‹¤íŒ¨:', error);
            }

            try {
                // ì˜ì–´ ëª…ì–¸ì„ í•œêµ­ì–´ë¡œ ë²ˆì—­í•œ ë°ì´í„° ë¡œë“œ
                const translatedQuotes = await fetchTranslatedQuotes();
                externalMessages.push(...translatedQuotes);
            } catch (error) {
                console.log('ë²ˆì—­ëœ ëª…ì–¸ ë¡œë“œ ì‹¤íŒ¨:', error);
            }

            // ëœë¤í•œ ì¶”ê°€ ë©”ì‹œì§€ ìƒì„±
            const additionalMessages = generateAdditionalMessages();
            externalMessages.push(...additionalMessages);

            return externalMessages;
        }

        // í•œêµ­ì–´ ëª…ì–¸ API í˜¸ì¶œ (ì˜ˆì‹œ)
        async function fetchKoreanQuotes() {
            // ì‹¤ì œ APIê°€ ìˆë‹¤ë©´ ì—¬ê¸°ì„œ í˜¸ì¶œ
            // í˜„ì¬ëŠ” ë”ë¯¸ ë°ì´í„° ë°˜í™˜
            return [
                { id: 1001, text: "ì²œ ë¦¬ ê¸¸ë„ í•œ ê±¸ìŒë¶€í„°.", category: "ì‹œì‘", timeOfDay: "all", season: "all" },
                { id: 1002, text: "êµ¬ìŠ¬ì´ ì„œ ë§ì´ì–´ë„ ê¿°ì–´ì•¼ ë³´ë°°.", category: "ì™„ì„±", timeOfDay: "all", season: "all" },
                { id: 1003, text: "ë‚®ë§ì€ ìƒˆê°€ ë“£ê³  ë°¤ë§ì€ ì¥ê°€ ë“£ëŠ”ë‹¤.", category: "ì§€í˜œ", timeOfDay: "all", season: "all" },
                { id: 1004, text: "ê¸‰í• ìˆ˜ë¡ ëŒì•„ê°€ë¼.", category: "ì¸ë‚´", timeOfDay: "all", season: "all" },
                { id: 1005, text: "í‹°ëŒ ëª¨ì•„ íƒœì‚°.", category: "ë…¸ë ¥", timeOfDay: "all", season: "all" }
            ];
        }

        // ë²ˆì—­ëœ ëª…ì–¸ ë¡œë“œ
        async function fetchTranslatedQuotes() {
            // ìœ ëª…í•œ ì˜ì–´ ëª…ì–¸ë“¤ì„ í•œêµ­ì–´ë¡œ ë²ˆì—­í•œ ë²„ì „
            return [
                { id: 2001, text: "ì–´ì œëŠ” ì§€ë‚˜ê°”ê³ , ë‚´ì¼ì€ ë¯¸ì§€ìˆ˜ë‹¤. í•˜ì§€ë§Œ ì˜¤ëŠ˜ì€ ì„ ë¬¼ì´ë‹¤.", category: "í˜„ì¬", timeOfDay: "all", season: "all" },
                { id: 2002, text: "ìœ„ëŒ€í•œ ì—…ì ì„ ì´ë£¨ëŠ” ìœ ì¼í•œ ë°©ë²•ì€ ìì‹ ì´ í•˜ëŠ” ì¼ì„ ì‚¬ë‘í•˜ëŠ” ê²ƒì´ë‹¤.", category: "ì—´ì •", timeOfDay: "all", season: "all" },
                { id: 2003, text: "ì„±ê³µì€ ìµœì¢… ëª©ì ì§€ê°€ ì•„ë‹ˆê³ , ì‹¤íŒ¨ëŠ” ì¹˜ëª…ì ì´ì§€ ì•Šë‹¤. ì¤‘ìš”í•œ ê²ƒì€ ê³„ì†í•  ìš©ê¸°ë‹¤.", category: "ìš©ê¸°", timeOfDay: "all", season: "all" },
                { id: 2004, text: "ìì‹ ì„ ë¯¿ì–´ë¼. ë‹¹ì‹ ì€ ìƒê°ë³´ë‹¤ ë” ìš©ê°í•˜ê³ , ë³´ì´ëŠ” ê²ƒë³´ë‹¤ ë” ê°•í•˜ë‹¤.", category: "ìì‹ ê°", timeOfDay: "all", season: "all" },
                { id: 2005, text: "í–‰ë³µì€ ì¤€ë¹„ëœ ë§ˆìŒì´ ê¸°íšŒë¥¼ ë§Œë‚¬ì„ ë•Œ ì¼ì–´ë‚œë‹¤.", category: "í–‰ë³µ", timeOfDay: "all", season: "all" }
            ];
        }

        // ì¶”ê°€ ë©”ì‹œì§€ ìƒì„± (ê³„ì ˆë³„, ì‹œê°„ë³„ íŠ¹í™”)
        function generateAdditionalMessages() {
            const currentMonth = new Date().getMonth() + 1;
            const currentHour = new Date().getHours();
            
            let seasonalMessages = [];
            
            // ê³„ì ˆë³„ ë©”ì‹œì§€
            if (currentMonth >= 3 && currentMonth <= 5) { // ë´„
                seasonalMessages = [
                    { id: 3001, text: "ìƒˆì‹¹ì´ ë‹ë“¯ ìƒˆë¡œìš´ ì‹œì‘ì„ ì‘ì›í•©ë‹ˆë‹¤.", category: "ê³„ì ˆ", timeOfDay: "all", season: "spring" },
                    { id: 3002, text: "ë´„ë°”ëŒì²˜ëŸ¼ ìƒì¾Œí•œ í•˜ë£¨ ë˜ì„¸ìš”.", category: "ê³„ì ˆ", timeOfDay: "morning", season: "spring" }
                ];
            } else if (currentMonth >= 6 && currentMonth <= 8) { // ì—¬ë¦„
                seasonalMessages = [
                    { id: 3003, text: "ëœ¨ê±°ìš´ íƒœì–‘ì²˜ëŸ¼ ì—´ì •ì ì¸ í•˜ë£¨ ë³´ë‚´ì„¸ìš”.", category: "ê³„ì ˆ", timeOfDay: "all", season: "summer" },
                    { id: 3004, text: "ì—¬ë¦„ì˜ ì—ë„ˆì§€ë¡œ í™œê¸°ì°¬ í•˜ë£¨ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.", category: "ê³„ì ˆ", timeOfDay: "morning", season: "summer" }
                ];
            } else if (currentMonth >= 9 && currentMonth <= 11) { // ê°€ì„
                seasonalMessages = [
                    { id: 3005, text: "ê°€ì„ ë‚™ì—½ì²˜ëŸ¼ ìì—°ìŠ¤ëŸ½ê²Œ ë³€í™”ë¥¼ ë°›ì•„ë“¤ì´ì„¸ìš”.", category: "ê³„ì ˆ", timeOfDay: "all", season: "autumn" },
                    { id: 3006, text: "ê°€ì„ í•˜ëŠ˜ì²˜ëŸ¼ ë§‘ì€ ë§ˆìŒìœ¼ë¡œ í•˜ë£¨ë¥¼ ì‹œì‘í•˜ì„¸ìš”.", category: "ê³„ì ˆ", timeOfDay: "morning", season: "autumn" }
                ];
            } else { // ê²¨ìš¸
                seasonalMessages = [
                    { id: 3007, text: "ê²¨ìš¸ì˜ ê³ ìš”í•¨ ì†ì—ì„œ ë‚´ë©´ì˜ í‰í™”ë¥¼ ì°¾ìœ¼ì„¸ìš”.", category: "ê³„ì ˆ", timeOfDay: "all", season: "winter" },
                    { id: 3008, text: "ë”°ëœ»í•œ ë§ˆìŒìœ¼ë¡œ ì¶”ìš´ ê²¨ìš¸ì„ ì´ê²¨ë‚´ì„¸ìš”.", category: "ê³„ì ˆ", timeOfDay: "all", season: "winter" }
                ];
            }

            // ì‹œê°„ëŒ€ë³„ ì¶”ê°€ ë©”ì‹œì§€
            const timeBasedMessages = [];
            if (currentHour >= 5 && currentHour < 12) {
                timeBasedMessages.push(
                    { id: 4001, text: "ì¢‹ì€ ì•„ì¹¨! ì˜¤ëŠ˜ë„ ë©‹ì§„ í•˜ë£¨ë¥¼ ë§Œë“¤ì–´ê°€ì„¸ìš”.", category: "ì•„ì¹¨ì¸ì‚¬", timeOfDay: "morning", season: "all" },
                    { id: 4002, text: "ìƒˆë²½ ê³µê¸°ì²˜ëŸ¼ ë§‘ì€ ë§ˆìŒìœ¼ë¡œ ì‹œì‘í•˜ì„¸ìš”.", category: "ì•„ì¹¨ì¸ì‚¬", timeOfDay: "morning", season: "all" }
                );
            } else if (currentHour >= 12 && currentHour < 17) {
                timeBasedMessages.push(
                    { id: 4003, text: "ì˜¤í›„ì˜ í–‡ì‚´ì²˜ëŸ¼ ë”°ëœ»í•œ ì‹œê°„ ë³´ë‚´ì„¸ìš”.", category: "ì˜¤í›„", timeOfDay: "afternoon", season: "all" },
                    { id: 4004, text: "í•˜ë£¨ì˜ ì¤‘ë°˜, ì ì‹œ ì‰¬ì–´ê°€ë©° ì—ë„ˆì§€ë¥¼ ì¶©ì „í•˜ì„¸ìš”.", category: "ì˜¤í›„", timeOfDay: "afternoon", season: "all" }
                );
            } else if (currentHour >= 17 && currentHour < 21) {
                timeBasedMessages.push(
                    { id: 4005, text: "í•˜ë£¨ë¥¼ ë§ˆë¬´ë¦¬í•˜ë©° ì˜¤ëŠ˜ì˜ ì„±ì·¨ë¥¼ ì¶•í•˜í•´ì£¼ì„¸ìš”.", category: "ì €ë…", timeOfDay: "evening", season: "all" },
                    { id: 4006, text: "ì„ì–‘ì²˜ëŸ¼ ì•„ë¦„ë‹¤ìš´ í•˜ë£¨ì˜ ë§ˆë¬´ë¦¬ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.", category: "ì €ë…", timeOfDay: "evening", season: "all" }
                );
            } else {
                timeBasedMessages.push(
                    { id: 4007, text: "ê³ ë¯¼ì´ ë§ì€ ë°¤, ë‚´ì¼ì€ ë” ì¢‹ì€ ë‚ ì´ ë  ê±°ì˜ˆìš”.", category: "ë°¤", timeOfDay: "night", season: "all" },
                    { id: 4008, text: "ë³„ë¹›ì²˜ëŸ¼ ì–´ë‘  ì†ì—ì„œë„ ë¹›ë‚˜ëŠ” í¬ë§ì„ ì°¾ìœ¼ì„¸ìš”.", category: "ë°¤", timeOfDay: "night", season: "all" }
                );
            }

            return [...seasonalMessages, ...timeBasedMessages];
        }

        // ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ ì‹œìŠ¤í…œ
        class MessageUpdateSystem {
            constructor() {
                this.lastUpdateCheck = localStorage.getItem('lastUpdateCheck');
                this.updateInterval = 24 * 60 * 60 * 1000; // 24ì‹œê°„
                this.maxRetries = 3;
            }

            // ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ í™•ì¸ ë° ì‹¤í–‰
            async checkForUpdates() {
                const now = Date.now();
                const lastCheck = this.lastUpdateCheck ? parseInt(this.lastUpdateCheck) : 0;
                
                // 24ì‹œê°„ë§ˆë‹¤ í•œ ë²ˆ ì—…ë°ì´íŠ¸ í™•ì¸
                if (now - lastCheck < this.updateInterval) {
                    console.log('ìµœê·¼ì— ì—…ë°ì´íŠ¸ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.');
                    return false;
                }

                console.log('ìƒˆë¡œìš´ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤...');
                
                try {
                    // ì™¸ë¶€ ì†ŒìŠ¤ì—ì„œ ìƒˆë¡œìš´ ë©”ì‹œì§€ ê°€ì ¸ì˜¤ê¸°
                    const newMessages = await this.fetchLatestMessages();
                    
                    if (newMessages.length > 0) {
                        await this.addNewMessages(newMessages);
                        console.log(`${newMessages.length}ê°œì˜ ìƒˆë¡œìš´ ë©”ì‹œì§€ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    }

                    // ì—…ë°ì´íŠ¸ ì‹œê°„ ê¸°ë¡
                    localStorage.setItem('lastUpdateCheck', now.toString());
                    return true;
                } catch (error) {
                    console.error('ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                    return false;
                }
            }

            // ìµœì‹  ë©”ì‹œì§€ ê°€ì ¸ì˜¤ê¸°
            async fetchLatestMessages() {
                const newMessages = [];
                
                // 1. ì‹¤ì œë¡œëŠ” ì—¬ê¸°ì„œ ì™¸ë¶€ API í˜¸ì¶œ
                // ì˜ˆ: ëª…ì–¸ API, RSS í”¼ë“œ, í¬ë¡¤ë§ ë“±
                
                // 2. í˜„ì¬ëŠ” ìƒ˜í”Œ ë°ì´í„° ë°˜í™˜
                const sampleNewMessages = this.generateDailyMessages();
                newMessages.push(...sampleNewMessages);

                // 3. ì‚¬ìš©ì ì œì¶œ ë©”ì‹œì§€ ê°€ì ¸ì˜¤ê¸° (API ì—°ë™)
                if (authToken) {
                    try {
                        const userSubmittedMessages = await this.fetchUserSubmittedMessages();
                        newMessages.push(...userSubmittedMessages);
                    } catch (error) {
                        console.log('ì‚¬ìš©ì ì œì¶œ ë©”ì‹œì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
                    }
                }

                return newMessages;
            }

            // ì¼ì¼ ë©”ì‹œì§€ ìƒì„±
            generateDailyMessages() {
                const today = new Date();
                const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
                
                // ë‚ ì§œ ê¸°ë°˜ìœ¼ë¡œ ê³ ìœ í•œ ë©”ì‹œì§€ ìƒì„±
                const dailyMessages = [
                    {
                        id: 5000 + dayOfYear,
                        text: this.getDailyInspiration(dayOfYear),
                        category: "ì˜¤ëŠ˜ì˜ ë©”ì‹œì§€",
                        timeOfDay: "all",
                        season: "all",
                        isDaily: true,
                        date: today.toISOString().split('T')[0]
                    }
                ];

                return dailyMessages;
            }

            // ë‚ ì§œë³„ ì˜ê° ë©”ì‹œì§€
            getDailyInspiration(dayOfYear) {
                const inspirations = [
                    "ì˜¤ëŠ˜ì€ ìƒˆë¡œìš´ ê°€ëŠ¥ì„±ì˜ ë‚ ì…ë‹ˆë‹¤.",
                    "ë‹¹ì‹ ì˜ ì ì¬ë ¥ì„ ë¯¿ê³  ë„ì „í•´ë³´ì„¸ìš”.",
                    "ì‘ì€ ì§„ì „ë„ í° ë³€í™”ì˜ ì‹œì‘ì…ë‹ˆë‹¤.",
                    "ì˜¤ëŠ˜ í•˜ë£¨ë„ ê°ì‚¬í•  ì¼ë“¤ì´ ê°€ë“í•  ê±°ì˜ˆìš”.",
                    "ë‹¹ì‹ ì˜ ë¯¸ì†Œê°€ ëˆ„êµ°ê°€ì—ê²Œ í¬ë§ì´ ë©ë‹ˆë‹¤.",
                    "í˜ë“  ì‹œê°„ë„ ì„±ì¥ì˜ ê¸°íšŒê°€ ë  ìˆ˜ ìˆì–´ìš”.",
                    "ì˜¤ëŠ˜ë„ ë‹¹ì‹ ë‹µê²Œ ì‚´ì•„ê°€ì„¸ìš”.",
                    "ìƒˆë¡œìš´ í•˜ë£¨, ìƒˆë¡œìš´ ê¸°íšŒê°€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.",
                    "ë‹¹ì‹ ì˜ ë…¸ë ¥ì€ ë°˜ë“œì‹œ ë³´ìƒë°›ì„ ê±°ì˜ˆìš”.",
                    "ì˜¤ëŠ˜ í•˜ë£¨ ìì‹ ì—ê²Œ ì¹œì ˆí•˜ê²Œ ëŒ€í•˜ì„¸ìš”."
                ];
                
                return inspirations[dayOfYear % inspirations.length];
            }

            // ì‚¬ìš©ì ì œì¶œ ë©”ì‹œì§€ ê°€ì ¸ì˜¤ê¸°
            async fetchUserSubmittedMessages() {
                try {
                    const response = await apiCall('/messages/approved');
                    return response.messages || [];
                } catch (error) {
                    return [];
                }
            }

            // ìƒˆ ë©”ì‹œì§€ ì¶”ê°€
            async addNewMessages(newMessages) {
                // ì¤‘ë³µ ì œê±°
                const existingIds = new Set(allMessages.map(msg => msg.id));
                const uniqueNewMessages = newMessages.filter(msg => !existingIds.has(msg.id));
                
                if (uniqueNewMessages.length > 0) {
                    allMessages.push(...uniqueNewMessages);
                    messages = [...allMessages];
                    
                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ìºì‹œ
                    try {
                        localStorage.setItem('cachedMessages', JSON.stringify(uniqueNewMessages));
                        localStorage.setItem('cacheTimestamp', Date.now().toString());
                    } catch (error) {
                        console.log('ë©”ì‹œì§€ ìºì‹œ ì €ì¥ ì‹¤íŒ¨:', error);
                    }
                }
            }

            // ìºì‹œëœ ë©”ì‹œì§€ ë¡œë“œ
            loadCachedMessages() {
                try {
                    const cached = localStorage.getItem('cachedMessages');
                    const timestamp = localStorage.getItem('cacheTimestamp');
                    
                    if (cached && timestamp) {
                        const cacheAge = Date.now() - parseInt(timestamp);
                        // 7ì¼ ì´ë‚´ì˜ ìºì‹œë§Œ ì‚¬ìš©
                        if (cacheAge < 7 * 24 * 60 * 60 * 1000) {
                            return JSON.parse(cached);
                        }
                    }
                } catch (error) {
                    console.log('ìºì‹œëœ ë©”ì‹œì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
                }
                return [];
            }
        }

        // ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ ì‹œìŠ¤í…œ ì¸ìŠ¤í„´ìŠ¤
        const messageUpdater = new MessageUpdateSystem();


        // ì‹œê°„ëŒ€ë³„ ë©”ì‹œì§€ í•„í„°ë§
        function getTimeBasedMessages() {
            const hour = new Date().getHours();
            let timeOfDay;
            
            if (hour >= 5 && hour < 12) timeOfDay = 'morning';
            else if (hour >= 12 && hour < 17) timeOfDay = 'afternoon';
            else if (hour >= 17 && hour < 21) timeOfDay = 'evening';
            else timeOfDay = 'night';
            
            const timeMessages = messages.filter(msg => 
                msg.timeOfDay === timeOfDay || msg.timeOfDay === 'all'
            );
            
            return timeMessages.length > 0 ? timeMessages : messages;
        }

        let currentMessageIndex = 0;

        // ì•ˆì „í•œ ìš”ì†Œ ì„ íƒ
        function safeGetElement(id) {
            return document.getElementById(id);
        }

        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(index = null, useTimeFilter = true) {
            // ë©”ì‹œì§€ê°€ ì—†ìœ¼ë©´ ë¦¬í„´
            if (!messages || messages.length === 0) {
                console.error('í‘œì‹œí•  ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì‹œê°„ëŒ€ë³„ í•„í„°ë§ ì ìš©
            const availableMessages = useTimeFilter ? getTimeBasedMessages() : messages;
            
            // ì¸ë±ìŠ¤ ê²°ì •
            if (index === null) {
                index = Math.floor(Math.random() * availableMessages.length);
            } else if (index >= availableMessages.length) {
                index = 0;
            }
            
            const message = availableMessages[index];
            currentMessageIndex = messages.findIndex(msg => msg.id === message.id);
            
            // UI ì—…ë°ì´íŠ¸
            const loading = safeGetElement('loading');
            const quoteContent = safeGetElement('quoteContent');
            const quoteText = safeGetElement('quoteText');
            const quoteCategory = safeGetElement('quoteCategory');
            
            if (loading) loading.style.display = 'none';
            if (quoteContent) quoteContent.style.display = 'block';
            
            if (quoteText) {
                quoteText.textContent = message.text;
                // í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜
                quoteText.style.opacity = '0';
                setTimeout(() => {
                    quoteText.style.opacity = '1';
                }, 100);
            }
            
            if (quoteCategory) {
                quoteCategory.textContent = `#${message.category}`;
            }
            
            // ì¦ê²¨ì°¾ê¸° ìƒíƒœ í™•ì¸ ë° í‘œì‹œ
            const favoriteIcon = document.querySelector('.favorite-icon');
            if (favoriteIcon) {
                const messageId = `msg_${message.id || currentMessageIndex}`;
                favoriteIcon.textContent = isFavorite(messageId) ? 'â¤ï¸' : 'ğŸ¤';
            }
            
            // ë¦¬ì•¡ì…˜ UI ì—…ë°ì´íŠ¸
            const messageId = message.id || currentMessageIndex;
            updateReactionUI(messageId);
            
            // ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
            addToHistory(message);
            
            console.log('ë©”ì‹œì§€ í‘œì‹œë¨:', message.text);
        }

        // ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ ê´€ë¦¬
        let messageHistory = [];
        
        function addToHistory(message) {
            // ì¤‘ë³µ ì œê±°
            messageHistory = messageHistory.filter(msg => msg.id !== message.id);
            // ìµœì‹  ë©”ì‹œì§€ë¥¼ ì•ì— ì¶”ê°€
            messageHistory.unshift({
                ...message,
                viewedAt: new Date().toISOString()
            });
            // ìµœëŒ€ 50ê°œê¹Œì§€ë§Œ ì €ì¥
            if (messageHistory.length > 50) {
                messageHistory = messageHistory.slice(0, 50);
            }
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('messageHistory', JSON.stringify(messageHistory));
        }

        // íˆìŠ¤í† ë¦¬ ë¡œë“œ
        function loadHistory() {
            try {
                const saved = localStorage.getItem('messageHistory');
                if (saved) {
                    messageHistory = JSON.parse(saved);
                }
            } catch (error) {
                console.error('íˆìŠ¤í† ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', error);
                messageHistory = [];
            }
        }

        // ì‚¬ì´ë“œë°” ê´€ë¦¬
        function toggleSidebar() {
            const sidebar = safeGetElement('sidebar');
            const overlay = safeGetElement('sidebarOverlay');
            if (sidebar) sidebar.classList.toggle('open');
            if (overlay) overlay.classList.toggle('show');
        }

        function closeSidebar() {
            const sidebar = safeGetElement('sidebar');
            const overlay = safeGetElement('sidebarOverlay');
            if (sidebar) sidebar.classList.remove('open');
            if (overlay) overlay.classList.remove('show');
        }

        // ì¸ê¸° ë©”ì‹œì§€ ê¸°ëŠ¥
        function showPopularMessages() {
            // ë¦¬ì•¡ì…˜ ìˆ˜ê°€ ë†’ì€ ë©”ì‹œì§€ë“¤ì„ ì •ë ¬
            const popularMessages = [];
            
            // ë©”ì‹œì§€ë³„ ì´ ë¦¬ì•¡ì…˜ ìˆ˜ ê³„ì‚°
            for (const messageId in messageReactions) {
                const reactions = messageReactions[messageId];
                const totalReactions = (reactions.like || 0) + (reactions.heart || 0) + (reactions.fire || 0);
                
                if (totalReactions > 0) {
                    // ì›ë³¸ ë©”ì‹œì§€ ì°¾ê¸°
                    const message = messages.find(msg => msg.id == messageId) || 
                                  fallbackMessages.find(msg => msg.id == messageId) ||
                                  { id: messageId, text: 'ì•Œ ìˆ˜ ì—†ëŠ” ë©”ì‹œì§€', category: 'ê¸°íƒ€' };
                    
                    popularMessages.push({
                        ...message,
                        totalReactions,
                        reactions: { ...reactions }
                    });
                }
            }
            
            // ë¦¬ì•¡ì…˜ ìˆ˜ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
            popularMessages.sort((a, b) => b.totalReactions - a.totalReactions);
            
            // ì¸ê¸° ë©”ì‹œì§€ê°€ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ì¸ê¸° ë©”ì‹œì§€ë“¤ í‘œì‹œ
            if (popularMessages.length === 0) {
                const defaultPopular = messages.slice(0, 5).map((msg, index) => ({
                    ...msg,
                    totalReactions: 10 - index,
                    reactions: { like: 3, heart: 4, fire: 3 - index }
                }));
                popularMessages.push(...defaultPopular);
            }
            
            // ëª¨ë‹¬ ë‚´ìš© ìƒì„±
            const modalContent = `
                <div class="modal" id="popularModal" style="display: block;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>ğŸ”¥ ì¸ê¸° ë©”ì‹œì§€</h2>
                            <button class="modal-close" onclick="document.getElementById('popularModal').remove()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="popular-messages-list">
                                ${popularMessages.slice(0, 10).map((msg, index) => `
                                    <div class="popular-message-item" onclick="showMessageById('${msg.id}')">
                                        <div class="popular-rank">${index + 1}</div>
                                        <div class="popular-content">
                                            <div class="popular-text">${msg.text}</div>
                                            <div class="popular-category">#${msg.category}</div>
                                        </div>
                                        <div class="popular-reactions">
                                            <span>ğŸ‘ ${msg.reactions.like || 0}</span>
                                            <span>â¤ï¸ ${msg.reactions.heart || 0}</span>
                                            <span>ğŸ”¥ ${msg.reactions.fire || 0}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalContent);
        }

        // ë©”ì‹œì§€ IDë¡œ ë©”ì‹œì§€ í‘œì‹œ
        function showMessageById(messageId) {
            const messageIndex = messages.findIndex(msg => msg.id == messageId);
            if (messageIndex >= 0) {
                currentMessageIndex = messageIndex;
                showMessage(messageIndex, false);
                document.getElementById('popularModal')?.remove();
            }
        }

        // ì¹œêµ¬ ì´ˆëŒ€ ê¸°ëŠ¥
        function showInviteModal() {
            const modalContent = `
                <div class="modal" id="inviteModal" style="display: block;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>ğŸ‘¥ ì¹œêµ¬ ì´ˆëŒ€</h2>
                            <button class="modal-close" onclick="document.getElementById('inviteModal').remove()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="invite-options">
                                <div class="invite-section">
                                    <h3>ğŸ“± ì•± ê³µìœ </h3>
                                    <p>ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ë§¤ì¼ ì¢‹ì€ ë©”ì‹œì§€ë¥¼ ë‚˜ëˆ ë³´ì„¸ìš”!</p>
                                    <button class="btn btn-primary" onclick="shareApp()">ì•± ê³µìœ í•˜ê¸°</button>
                                </div>
                                
                                <div class="invite-section">
                                    <h3>ğŸ’Œ ë©”ì‹œì§€ ê³µìœ </h3>
                                    <p>í˜„ì¬ ë©”ì‹œì§€ë¥¼ ì¹œêµ¬ì—ê²Œ ë³´ë‚´ë³´ì„¸ìš”.</p>
                                    <button class="btn btn-secondary" onclick="shareMessage()">í˜„ì¬ ë©”ì‹œì§€ ê³µìœ </button>
                                </div>
                                
                                <div class="invite-section">
                                    <h3>ğŸ”— ì´ˆëŒ€ ë§í¬</h3>
                                    <p>ë§í¬ë¥¼ ë³µì‚¬í•´ì„œ ì¹œêµ¬ë“¤ì—ê²Œ ë³´ë‚´ì„¸ìš”.</p>
                                    <div class="invite-link">
                                        <input type="text" value="${window.location.href}" readonly>
                                        <button class="btn btn-outline" onclick="copyInviteLink()">ë³µì‚¬</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalContent);
        }

        // ì•± ê³µìœ í•˜ê¸°
        function shareApp() {
            const shareData = {
                title: 'ëª¨ë‹ ì•± - ë§¤ì¼ ì¢‹ì€ ì‹œì‘',
                text: 'ë§¤ì¼ ì•„ì¹¨ ì¢‹ì€ ë©”ì‹œì§€ë¡œ í•˜ë£¨ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”! ğŸŒ…',
                url: window.location.href
            };
            
            if (navigator.share) {
                navigator.share(shareData);
            } else {
                // í´ë¦½ë³´ë“œ ë³µì‚¬
                navigator.clipboard.writeText(`${shareData.title}\n${shareData.text}\n${shareData.url}`);
                alert('ì•± ì •ë³´ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }

        // ì´ˆëŒ€ ë§í¬ ë³µì‚¬
        function copyInviteLink() {
            const linkInput = document.querySelector('.invite-link input');
            linkInput.select();
            navigator.clipboard.writeText(linkInput.value);
            alert('ì´ˆëŒ€ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ìŠµê´€ íŠ¸ë˜ì»¤ ê¸°ëŠ¥
        function showHabitTracker() {
            const modalContent = `
                <div class="modal" id="habitModal" style="display: block;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>ğŸ“Š ìŠµê´€ íŠ¸ë˜ì»¤</h2>
                            <button class="modal-close" onclick="document.getElementById('habitModal').remove()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="habit-tracker">
                                <div class="habit-stats">
                                    <div class="stat-item">
                                        <div class="stat-number">${getTodayVisitCount()}</div>
                                        <div class="stat-label">ì˜¤ëŠ˜ ë°©ë¬¸</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number">${getStreakCount()}</div>
                                        <div class="stat-label">ì—°ì† ì¼ìˆ˜</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number">${getTotalMessages()}</div>
                                        <div class="stat-label">ë³¸ ë©”ì‹œì§€</div>
                                    </div>
                                </div>
                                
                                <div class="habit-calendar">
                                    <h3>ğŸ“… ì´ë²ˆ ë‹¬ í™œë™</h3>
                                    <div id="habitCalendar">${generateHabitCalendar()}</div>
                                </div>
                                
                                <div class="habit-goals">
                                    <h3>ğŸ¯ ì´ë²ˆ ì£¼ ëª©í‘œ</h3>
                                    <div class="goal-progress">
                                        <div class="goal-item">
                                            <span>ë§¤ì¼ ë©”ì‹œì§€ í™•ì¸</span>
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: ${Math.min(100, (getTodayVisitCount() / 1) * 100)}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalContent);
        }

        // ìŠµê´€ íŠ¸ë˜ì»¤ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function getTodayVisitCount() {
            const today = new Date().toDateString();
            const visits = JSON.parse(localStorage.getItem('dailyVisits') || '{}');
            return visits[today] || 0;
        }

        function getStreakCount() {
            const visits = JSON.parse(localStorage.getItem('dailyVisits') || '{}');
            let streak = 0;
            let currentDate = new Date();
            
            while (true) {
                const dateStr = currentDate.toDateString();
                if (visits[dateStr]) {
                    streak++;
                    currentDate.setDate(currentDate.getDate() - 1);
                } else {
                    break;
                }
            }
            
            return streak;
        }

        function getTotalMessages() {
            return messageHistory.length;
        }

        function generateHabitCalendar() {
            const visits = JSON.parse(localStorage.getItem('dailyVisits') || '{}');
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            let calendar = '<div class="calendar-grid">';
            
            // ë¹ˆ ë‚ ì§œë“¤
            for (let i = 0; i < firstDay.getDay(); i++) {
                calendar += '<div class="calendar-day empty"></div>';
            }
            
            // ì‹¤ì œ ë‚ ì§œë“¤
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(today.getFullYear(), today.getMonth(), day);
                const dateStr = date.toDateString();
                const hasVisit = visits[dateStr] > 0;
                const isToday = day === today.getDate();
                
                calendar += `<div class="calendar-day ${hasVisit ? 'visited' : ''} ${isToday ? 'today' : ''}">${day}</div>`;
            }
            
            calendar += '</div>';
            return calendar;
        }

        // ë©”ì‹œì§€ ì œì¶œ ê¸°ëŠ¥
        function showSubmitModal() {
            const modalContent = `
                <div class="modal" id="submitModal" style="display: block;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>âœï¸ ë©”ì‹œì§€ ì œì¶œ</h2>
                            <button class="modal-close" onclick="document.getElementById('submitModal').remove()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="submit-form">
                                <div class="form-group">
                                    <label for="submitText">ğŸ’­ ë©”ì‹œì§€ ë‚´ìš©</label>
                                    <textarea id="submitText" placeholder="ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ ë‚˜ëˆ„ê³  ì‹¶ì€ ì¢‹ì€ ë©”ì‹œì§€ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”..." rows="4"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label for="submitCategory">ğŸ·ï¸ ì¹´í…Œê³ ë¦¬</label>
                                    <select id="submitCategory">
                                        <option value="ë™ê¸°ë¶€ì—¬">ë™ê¸°ë¶€ì—¬</option>
                                        <option value="ê°ì‚¬">ê°ì‚¬</option>
                                        <option value="ì„±ì°°">ì„±ì°°</option>
                                        <option value="í¬ë§">í¬ë§</option>
                                        <option value="ì§€í˜œ">ì§€í˜œ</option>
                                        <option value="í–‰ë³µ">í–‰ë³µ</option>
                                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="submitAuthor">ğŸ‘¤ ì‘ì„±ì (ì„ íƒì‚¬í•­)</label>
                                    <input type="text" id="submitAuthor" placeholder="ìµëª…">
                                </div>
                                
                                <div class="submit-preview" id="submitPreview" style="display: none;">
                                    <h3>ğŸ‘€ ë¯¸ë¦¬ë³´ê¸°</h3>
                                    <div class="preview-message">
                                        <div class="preview-text" id="previewText"></div>
                                        <div class="preview-category" id="previewCategory"></div>
                                    </div>
                                </div>
                                
                                <div class="submit-actions">
                                    <button class="btn btn-secondary" onclick="previewSubmission()">ë¯¸ë¦¬ë³´ê¸°</button>
                                    <button class="btn btn-primary" onclick="submitMessage()">ì œì¶œí•˜ê¸°</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalContent);
        }

        // ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°
        function previewSubmission() {
            const text = document.getElementById('submitText').value;
            const category = document.getElementById('submitCategory').value;
            
            if (!text.trim()) {
                alert('ë©”ì‹œì§€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            document.getElementById('previewText').textContent = text;
            document.getElementById('previewCategory').textContent = `#${category}`;
            document.getElementById('submitPreview').style.display = 'block';
        }

        // ë©”ì‹œì§€ ì œì¶œ
        function submitMessage() {
            const text = document.getElementById('submitText').value;
            const category = document.getElementById('submitCategory').value;
            const author = document.getElementById('submitAuthor').value || 'ìµëª…';
            
            if (!text.trim()) {
                alert('ë©”ì‹œì§€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë¡œì»¬ ì €ì¥ì†Œì— ì œì¶œëœ ë©”ì‹œì§€ ì €ì¥
            const submittedMessages = JSON.parse(localStorage.getItem('submittedMessages') || '[]');
            const newMessage = {
                id: Date.now(),
                text: text.trim(),
                category,
                author,
                submittedAt: new Date().toISOString(),
                status: 'pending'
            };
            
            submittedMessages.push(newMessage);
            localStorage.setItem('submittedMessages', JSON.stringify(submittedMessages));
            
            alert('ë©”ì‹œì§€ê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤! ê²€í†  í›„ ì•±ì— ë°˜ì˜ë  ì˜ˆì •ì…ë‹ˆë‹¤. ğŸ’');
            document.getElementById('submitModal').remove();
        }

        // ì„¤ì • ê¸°ëŠ¥
        function showSettingsModal() {
            const settings = JSON.parse(localStorage.getItem('appSettings') || '{}');
            
            const modalContent = `
                <div class="modal" id="settingsModal" style="display: block;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>âš™ï¸ ì•± ì„¤ì •</h2>
                            <button class="modal-close" onclick="document.getElementById('settingsModal').remove()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="settings-form">
                                <div class="settings-section">
                                    <h3>ğŸ”” ì•Œë¦¼ ì„¤ì •</h3>
                                    <div class="setting-item">
                                        <label>
                                            <input type="checkbox" id="enableNotifications" ${settings.enableNotifications ? 'checked' : ''}>
                                            í‘¸ì‹œ ì•Œë¦¼ ë°›ê¸°
                                        </label>
                                    </div>
                                    <div class="setting-item">
                                        <label for="notificationTime">ì•Œë¦¼ ì‹œê°„</label>
                                        <input type="time" id="notificationTime" value="${settings.notificationTime || '09:00'}">
                                    </div>
                                </div>
                                
                                <div class="settings-section">
                                    <h3>ğŸ¨ í…Œë§ˆ ì„¤ì •</h3>
                                    <div class="setting-item">
                                        <label for="theme">í…Œë§ˆ ì„ íƒ</label>
                                        <select id="theme">
                                            <option value="light" ${settings.theme === 'light' ? 'selected' : ''}>ë°ì€ í…Œë§ˆ</option>
                                            <option value="dark" ${settings.theme === 'dark' ? 'selected' : ''}>ì–´ë‘ìš´ í…Œë§ˆ</option>
                                            <option value="auto" ${settings.theme === 'auto' ? 'selected' : ''}>ìë™</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="settings-section">
                                    <h3>ğŸ“± ì•± ì •ë³´</h3>
                                    <div class="app-info">
                                        <p><strong>ë²„ì „:</strong> 1.0.0</p>
                                        <p><strong>ê°œë°œì:</strong> ëª¨ë‹íŒ€</p>
                                        <p><strong>ë¬¸ì˜:</strong> morning@example.com</p>
                                    </div>
                                </div>
                                
                                <div class="settings-actions">
                                    <button class="btn btn-outline" onclick="resetSettings()">ì„¤ì • ì´ˆê¸°í™”</button>
                                    <button class="btn btn-primary" onclick="saveSettings()">ì €ì¥</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalContent);
        }

        // ì„¤ì • ì €ì¥
        function saveSettings() {
            const settings = {
                enableNotifications: document.getElementById('enableNotifications').checked,
                notificationTime: document.getElementById('notificationTime').value,
                theme: document.getElementById('theme').value
            };
            
            localStorage.setItem('appSettings', JSON.stringify(settings));
            
            // í…Œë§ˆ ì ìš©
            applyTheme(settings.theme);
            
            alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            document.getElementById('settingsModal').remove();
        }

        // ì„¤ì • ì´ˆê¸°í™”
        function resetSettings() {
            if (confirm('ëª¨ë“  ì„¤ì •ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('appSettings');
                alert('ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                document.getElementById('settingsModal').remove();
            }
        }

        // í…Œë§ˆ ì ìš©
        function applyTheme(theme) {
            const body = document.body;
            body.classList.remove('light-theme', 'dark-theme');
            
            if (theme === 'dark') {
                body.classList.add('dark-theme');
            } else if (theme === 'light') {
                body.classList.add('light-theme');
            } else {
                // ìë™: ì‹œìŠ¤í…œ ì„¤ì • ë”°ë¼ê°€ê¸°
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                body.classList.add(prefersDark ? 'dark-theme' : 'light-theme');
            }
        }

        // ì¼ì¼ ë°©ë¬¸ ì¶”ì 
        function trackDailyVisit() {
            const today = new Date().toDateString();
            const visits = JSON.parse(localStorage.getItem('dailyVisits') || '{}');
            
            visits[today] = (visits[today] || 0) + 1;
            localStorage.setItem('dailyVisits', JSON.stringify(visits));
        }

        // ì¦ê²¨ì°¾ê¸° í† ê¸€
        // ë¦¬ì•¡ì…˜ ê¸°ëŠ¥
        let messageReactions = {};

        // ë¦¬ì•¡ì…˜ ë°ì´í„° ë¡œë“œ
        function loadReactions() {
            try {
                const saved = localStorage.getItem('messageReactions');
                messageReactions = saved ? JSON.parse(saved) : {};
            } catch (error) {
                console.error('ë¦¬ì•¡ì…˜ ë¡œë“œ ì‹¤íŒ¨:', error);
                messageReactions = {};
            }
        }

        // ë¦¬ì•¡ì…˜ ë°ì´í„° ì €ì¥
        function saveReactions() {
            try {
                localStorage.setItem('messageReactions', JSON.stringify(messageReactions));
            } catch (error) {
                console.error('ë¦¬ì•¡ì…˜ ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        // ë¦¬ì•¡ì…˜ ì²˜ë¦¬
        function handleReaction(reactionType) {
            if (!messages || messages.length === 0 || !messages[currentMessageIndex]) {
                return;
            }
            
            const messageId = messages[currentMessageIndex].id || currentMessageIndex;
            
            // ë©”ì‹œì§€ë³„ ë¦¬ì•¡ì…˜ ì´ˆê¸°í™”
            if (!messageReactions[messageId]) {
                messageReactions[messageId] = { like: 0, heart: 0, fire: 0 };
            }
            
            // ì‚¬ìš©ìë³„ ë¦¬ì•¡ì…˜ ìƒíƒœ ì²´í¬ (ê°„ë‹¨í•œ êµ¬í˜„)
            const userReactionKey = `user_${messageId}_${reactionType}`;
            const hasReacted = localStorage.getItem(userReactionKey);
            
            if (hasReacted) {
                // ì´ë¯¸ ë¦¬ì•¡ì…˜í•œ ê²½ìš° ì·¨ì†Œ
                messageReactions[messageId][reactionType] = Math.max(0, messageReactions[messageId][reactionType] - 1);
                localStorage.removeItem(userReactionKey);
            } else {
                // ìƒˆë¡œìš´ ë¦¬ì•¡ì…˜
                messageReactions[messageId][reactionType] += 1;
                localStorage.setItem(userReactionKey, 'true');
            }
            
            // UI ì—…ë°ì´íŠ¸
            updateReactionUI(messageId);
            saveReactions();
            
            // ê°„ë‹¨í•œ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            const btn = document.getElementById(`${reactionType}Btn`);
            if (btn) {
                btn.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    btn.style.transform = 'scale(1)';
                }, 150);
            }
        }

        // ë¦¬ì•¡ì…˜ UI ì—…ë°ì´íŠ¸
        function updateReactionUI(messageId) {
            if (!messageReactions[messageId]) {
                messageReactions[messageId] = { like: 0, heart: 0, fire: 0 };
            }
            
            const reactions = messageReactions[messageId];
            
            // ê° ë¦¬ì•¡ì…˜ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            const likeCount = document.getElementById('likeCount');
            const heartCount = document.getElementById('heartCount');
            const fireCount = document.getElementById('fireCount');
            
            if (likeCount) likeCount.textContent = reactions.like || 0;
            if (heartCount) heartCount.textContent = reactions.heart || 0;
            if (fireCount) fireCount.textContent = reactions.fire || 0;
            
            // ì‚¬ìš©ìê°€ ë¦¬ì•¡ì…˜í–ˆëŠ”ì§€ í‘œì‹œ
            ['like', 'heart', 'fire'].forEach(type => {
                const userReactionKey = `user_${messageId}_${type}`;
                const hasReacted = localStorage.getItem(userReactionKey);
                const btn = document.getElementById(`${type}Btn`);
                
                if (btn) {
                    if (hasReacted) {
                        btn.style.opacity = '1';
                        btn.style.background = '#e3f2fd';
                    } else {
                        btn.style.opacity = '0.7';
                        btn.style.background = '';
                    }
                }
            });
        }

        function toggleFavorite() {
            const favoriteBtn = safeGetElement('favoriteBtn');
            const icon = favoriteBtn?.querySelector('.favorite-icon');
            
            if (!icon || !favoriteBtn) return;
            
            const currentMessage = messages[currentMessageIndex];
            if (!currentMessage) return;
            
            const messageId = `msg_${currentMessage.id || currentMessageIndex}`;
            const isCurrentlyFavorited = icon.textContent === 'â¤ï¸';
            
            if (!isCurrentlyFavorited) {
                // ì¦ê²¨ì°¾ê¸° ì¶”ê°€
                const success = addFavorite(messageId, {
                    text: currentMessage.text,
                    category: currentMessage.category,
                    timestamp: new Date().toISOString()
                });
                
                if (success) {
                    icon.textContent = 'â¤ï¸';
                    console.log('ì¦ê²¨ì°¾ê¸° ì¶”ê°€ë¨');
                } else {
                    console.log('ì´ë¯¸ ì¦ê²¨ì°¾ê¸°ì— ìˆëŠ” ë©”ì‹œì§€ì…ë‹ˆë‹¤.');
                }
            } else {
                // ì¦ê²¨ì°¾ê¸° ì œê±°
                const success = removeFavorite(messageId);
                if (success) {
                    icon.textContent = 'ğŸ¤';
                    console.log('ì¦ê²¨ì°¾ê¸° ì œê±°ë¨');
                }
            }
        }

        // ê³µìœ  ê¸°ëŠ¥
        function shareMessage() {
            const quoteText = safeGetElement('quoteText');
            const messageText = quoteText?.textContent || 'ìƒˆë¡œìš´ í•˜ë£¨ê°€ ì‹œì‘ë©ë‹ˆë‹¤!';
            const shareText = `${messageText}\n\nğŸŒ… ëª¨ë‹ ì•±ì—ì„œ`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'ëª¨ë‹ - ì•„ì¹¨ ë©”ì‹œì§€',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('ë©”ì‹œì§€ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                });
            }
        }

        // ìŒì„± ì¬ìƒ
        function speakMessage() {
            const quoteText = safeGetElement('quoteText');
            const messageText = quoteText?.textContent || 'ìƒˆë¡œìš´ í•˜ë£¨ê°€ ì‹œì‘ë©ë‹ˆë‹¤!';
            
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(messageText);
                utterance.lang = 'ko-KR';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            } else {
                alert('ìŒì„± ì¬ìƒì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
            }
        }

        // ë‚ ì§œ í‘œì‹œ
        function displayDate() {
            const dateDisplay = safeGetElement('dateDisplay');
            if (dateDisplay) {
                const today = new Date();
                dateDisplay.textContent = today.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'long'
                });
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì¤‘...');
            
            // í–„ë²„ê±° ë©”ë‰´
            const hamburgerBtn = safeGetElement('hamburgerBtn');
            const sidebarClose = safeGetElement('sidebarClose');
            const sidebarOverlay = safeGetElement('sidebarOverlay');
            
            if (hamburgerBtn) hamburgerBtn.addEventListener('click', toggleSidebar);
            if (sidebarClose) sidebarClose.addEventListener('click', closeSidebar);
            if (sidebarOverlay) sidebarOverlay.addEventListener('click', closeSidebar);
            
            // ë¦¬ì•¡ì…˜ ë²„íŠ¼ë“¤
            const likeBtn = safeGetElement('likeBtn');
            const heartBtn = safeGetElement('heartBtn');
            const fireBtn = safeGetElement('fireBtn');
            
            if (likeBtn) likeBtn.addEventListener('click', () => handleReaction('like'));
            if (heartBtn) heartBtn.addEventListener('click', () => handleReaction('heart'));
            if (fireBtn) fireBtn.addEventListener('click', () => handleReaction('fire'));
            
            // í€µ ì•¡ì…˜ ë²„íŠ¼ë“¤
            const quickNewBtn = safeGetElement('quickNewBtn');
            const quickShareBtn = safeGetElement('quickShareBtn');
            const quickSpeakBtn = safeGetElement('quickSpeakBtn');
            
            if (quickNewBtn) quickNewBtn.addEventListener('click', () => showMessage());
            if (quickShareBtn) quickShareBtn.addEventListener('click', shareMessage);
            if (quickSpeakBtn) quickSpeakBtn.addEventListener('click', speakMessage);
            
            // ìƒˆ ë©”ì‹œì§€ ë²„íŠ¼ë“¤
            const newQuoteBtn = safeGetElement('newQuoteBtn');
            
            if (newQuoteBtn) {
                newQuoteBtn.addEventListener('click', () => {
                    showMessage();
                    closeSidebar();
                });
            }
            
            // ì¦ê²¨ì°¾ê¸° ë²„íŠ¼
            const favoriteBtn = safeGetElement('favoriteBtn');
            if (favoriteBtn) {
                favoriteBtn.addEventListener('click', toggleFavorite);
            }
            
            
            // ì¸ì¦ í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            const loginForm = safeGetElement('loginForm');
            const registerForm = safeGetElement('registerForm');
            
            if (loginForm) {
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const username = safeGetElement('loginUsername').value;
                    const password = safeGetElement('loginPassword').value;
                    
                    try {
                        showAuthMessage('ë¡œê·¸ì¸ ì¤‘...', false);
                        await login(username, password);
                        showAuthMessage('ë¡œê·¸ì¸ ì„±ê³µ!', false);
                        setTimeout(() => {
                            const modal = safeGetElement('authModal');
                            if (modal) modal.style.display = 'none';
                        }, 1000);
                    } catch (error) {
                        showAuthMessage('ë¡œê·¸ì¸ ì‹¤íŒ¨: ì‚¬ìš©ìëª… ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.', true);
                    }
                });
            }
            
            if (registerForm) {
                registerForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const username = safeGetElement('registerUsername').value;
                    const email = safeGetElement('registerEmail').value;
                    const displayName = safeGetElement('registerDisplayName').value;
                    const password = safeGetElement('registerPassword').value;
                    const passwordConfirm = safeGetElement('registerPasswordConfirm').value;
                    
                    if (password !== passwordConfirm) {
                        showAuthMessage('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', true);
                        return;
                    }
                    
                    try {
                        showAuthMessage('íšŒì›ê°€ì… ì¤‘...', false);
                        await register(username, email, password, displayName);
                        showAuthMessage('íšŒì›ê°€ì… ì„±ê³µ!', false);
                        setTimeout(() => {
                            const modal = safeGetElement('authModal');
                            if (modal) modal.style.display = 'none';
                        }, 1000);
                    } catch (error) {
                        showAuthMessage('íšŒì›ê°€ì… ì‹¤íŒ¨: ì‚¬ìš©ìëª…ì´ ì´ë¯¸ ì¡´ì¬í•˜ê±°ë‚˜ ì…ë ¥ ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.', true);
                    }
                });
            }

            // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ë“¤
            const modalCloseButtons = document.querySelectorAll('.modal-close');
            modalCloseButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const modalId = this.getAttribute('data-modal');
                    const modal = modalId ? safeGetElement(modalId) : this.closest('.modal');
                    if (modal) {
                        modal.style.display = 'none';
                    }
                });
            });

            // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ì‹œ ë‹«ê¸°
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            });

            // ë©”ë‰´ ì•„ì´í…œë“¤
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    const action = this.id.replace('Btn', '');
                    console.log('ë©”ë‰´ í´ë¦­:', action);
                    
                    switch(action) {
                        case 'newQuote':
                            showMessage();
                            break;
                        case 'favorites':
                            showFavoritesModal();
                            break;
                        case 'history':
                            showHistoryModal();
                            break;
                        case 'popular':
                            showPopularMessages();
                            break;
                        case 'share':
                            shareMessage();
                            break;
                        case 'invite':
                            showInviteModal();
                            break;
                        case 'habit':
                            showHabitTracker();
                            break;
                        case 'submit':
                            showSubmitModal();
                            break;
                        case 'settings':
                            showSettingsModal();
                            break;
                        default:
                            console.log('ì•Œ ìˆ˜ ì—†ëŠ” ì•¡ì…˜:', action);
                    }
                    closeSidebar();
                });
            });
            
            console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
        }

        // ì´ˆê¸°í™”
        async function init() {
            console.log('ì•± ì´ˆê¸°í™” ì‹œì‘...');
            
            try {
                // ë°ì´í„° ë¡œë“œ
                await loadMessages(); // ë©”ì‹œì§€ ë°ì´í„° ë¡œë“œ
                loadUserSession(); // ì‚¬ìš©ì ì„¸ì…˜ ë¡œë“œ
                loadHistory(); // íˆìŠ¤í† ë¦¬ ë¡œë“œ
                loadLocalFavorites(); // ë¡œì»¬ ì¦ê²¨ì°¾ê¸° ë¡œë“œ
                loadReactions(); // ë¦¬ì•¡ì…˜ ë°ì´í„° ë¡œë“œ
                
                // UI ì´ˆê¸°í™”
                setupEventListeners();
                trackDailyVisit(); // ì¼ì¼ ë°©ë¬¸ ì¶”ì 
                showMessage(); // ëœë¤ ë©”ì‹œì§€ í‘œì‹œ
                displayDate();
                
                console.log('ì•± ì´ˆê¸°í™” ì™„ë£Œ!');
            } catch (error) {
                console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                // ìµœì†Œí•œ ë©”ì‹œì§€ë¼ë„ í‘œì‹œ
                const loading = safeGetElement('loading');
                const quoteContent = safeGetElement('quoteContent');
                const quoteText = safeGetElement('quoteText');
                
                if (loading) loading.style.display = 'none';
                if (quoteContent) quoteContent.style.display = 'block';
                if (quoteText) quoteText.textContent = 'ìƒˆë¡œìš´ í•˜ë£¨ê°€ ì‹œì‘ë©ë‹ˆë‹¤. ì˜¤ëŠ˜ë„ ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”! âœ¨';
            }
        }

        // ì¦‰ì‹œ ì‹¤í–‰ (ê°•ì œ)
        console.log('ì¦‰ì‹œ ì‹¤í–‰ ì‹œì‘...');
        
        // 0.5ì´ˆ í›„ ê°•ì œ ì‹¤í–‰
        setTimeout(() => {
            console.log('ê°•ì œ ì‹¤í–‰ ì¤‘...');
            try {
                // ë°”ë¡œ ë¡œë”© ìˆ¨ê¸°ê³  ë©”ì‹œì§€ í‘œì‹œ
                const loading = document.getElementById('loading');
                const quoteContent = document.getElementById('quoteContent');
                const quoteText = document.getElementById('quoteText');
                const quoteCategory = document.getElementById('quoteCategory');
                
                if (loading) {
                    loading.style.display = 'none';
                    console.log('ë¡œë”© ìˆ¨ê¹€');
                }
                if (quoteContent) {
                    quoteContent.style.display = 'block';
                    console.log('ì½˜í…ì¸  í‘œì‹œ');
                }
                if (quoteText) {
                    quoteText.textContent = 'ìƒˆë¡œìš´ í•˜ë£¨ê°€ ì‹œì‘ë©ë‹ˆë‹¤. ì˜¤ëŠ˜ë„ ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”! ğŸŒ…';
                    console.log('ë©”ì‹œì§€ í…ìŠ¤íŠ¸ ì„¤ì •');
                }
                if (quoteCategory) {
                    quoteCategory.textContent = '#ìƒˆë¡œìš´ ì‹œì‘';
                    console.log('ì¹´í…Œê³ ë¦¬ ì„¤ì •');
                }
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë„ ì„¤ì •
                setupEventListeners();
                
                console.log('ê°•ì œ ì‹¤í–‰ ì™„ë£Œ!');
            } catch (error) {
                console.error('ê°•ì œ ì‹¤í–‰ ì˜¤ë¥˜:', error);
            }
        }, 500);

        // DOM ë¡œë“œ ì™„ë£Œ í›„ì—ë„ ì‹¤í–‰
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        console.log('ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì™„ë£Œ');
    </script>
</body>
</html>