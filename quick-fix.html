<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>모닝 - 빠른 수정</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .error-notice {
            position: fixed;
            top: 10px;
            left: 10px;
            background: #ef4444;
            color: white;
            padding: 10px;
            border-radius: 8px;
            z-index: 10000;
            display: none;
        }
    </style>
</head>
<body>
    <div class="error-notice" id="errorNotice">오류 발견! 콘솔을 확인하세요.</div>
    
    <!-- 햄버거 메뉴 버튼 -->
    <button class="hamburger-btn" id="hamburgerBtn" aria-label="메뉴 열기">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- 사이드바 메뉴 -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>🌅 모닝</h2>
            <button class="sidebar-close" id="sidebarClose">&times;</button>
        </div>
        
        <div class="sidebar-content">
            <div class="user-info">
                <div class="user-greeting">안녕하세요!</div>
                <div class="user-streak">
                    <span class="streak-icon">🔥</span>
                    <span id="streakNumber">0</span>일 연속 방문
                </div>
            </div>

            <div class="menu-section">
                <h3>📝 메시지</h3>
                <button class="menu-item" id="newQuoteBtn">
                    <span class="menu-icon">🌅</span>
                    새로운 메시지
                </button>
                <button class="menu-item" id="favoritesBtn">
                    <span class="menu-icon">⭐</span>
                    즐겨찾기
                </button>
                <button class="menu-item" id="historyBtn">
                    <span class="menu-icon">📚</span>
                    히스토리
                </button>
            </div>

            <div class="menu-section">
                <h3>📱 기능</h3>
                <button class="menu-item" id="journalBtn">
                    <span class="menu-icon">📝</span>
                    일기
                </button>
                <button class="menu-item" id="goalsBtn">
                    <span class="menu-icon">🎯</span>
                    목표
                </button>
            </div>

            <div class="menu-section">
                <h3>⚙️ 설정</h3>
                <button class="menu-item" id="settingsBtn">
                    <span class="menu-icon">⚙️</span>
                    앱 설정
                </button>
            </div>
        </div>
    </nav>

    <!-- 사이드바 오버레이 -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- 메인 콘텐츠 -->
    <main class="main-content" id="main-content">
        <div class="quote-container">
            <div class="quote-card">
                <div class="loading" id="loading">
                    <div class="loading-spinner"></div>
                    <p>메시지를 준비하고 있어요...</p>
                </div>
                <div class="quote-content" id="quoteContent" style="display: none;">
                    <div class="quote-actions">
                        <button class="favorite-btn" id="favoriteBtn">
                            <span class="favorite-icon">🤍</span>
                        </button>
                    </div>
                    <blockquote class="quote-text" id="quoteText">메시지를 불러오는 중...</blockquote>
                    <cite class="quote-author" id="quoteAuthor">- 모닝</cite>
                    <div class="quote-category" id="quoteCategory">#새로운시작</div>
                </div>
            </div>
            
            <div class="quick-actions">
                <button class="quick-action-btn" id="quickNewBtn" title="새로운 메시지">🔄</button>
                <button class="quick-action-btn" id="quickShareBtn" title="공유하기">📤</button>
                <button class="quick-action-btn" id="quickSpeakBtn" title="음성듣기">🔊</button>
            </div>
        </div>
    </main>
    
    <footer class="footer">
        <div class="date-display" id="dateDisplay"></div>
    </footer>

    <script>
        // 즉시 오류 캐치
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('전역 오류:', msg, 'at', url, ':', lineNo);
            document.getElementById('errorNotice').style.display = 'block';
            document.getElementById('errorNotice').textContent = `오류: ${msg}`;
            return false;
        };

        window.addEventListener('unhandledrejection', function(event) {
            console.error('Promise 오류:', event.reason);
            document.getElementById('errorNotice').style.display = 'block';
            document.getElementById('errorNotice').textContent = `Promise 오류: ${event.reason}`;
        });

        console.log('빠른 수정 버전 시작...');

        // 기본 메시지 데이터 (외부 파일 의존성 제거)
        const messages = [
            { text: "새로운 하루가 시작됩니다. 오늘도 좋은 하루 되세요! 🌅", author: "모닝 팀", category: "morning" },
            { text: "작은 걸음도 앞으로 나아가는 것입니다.", author: "익명", category: "motivation" },
            { text: "오늘 하루도 감사한 마음으로 시작해보세요.", author: "모닝 팀", category: "gratitude" },
            { text: "당신의 꿈은 충분히 가치가 있습니다.", author: "익명", category: "dreams" },
            { text: "지금 이 순간이 새로운 시작의 기회입니다.", author: "모닝 팀", category: "opportunity" }
        ];

        let currentMessageIndex = 0;

        // DOM 요소들
        const elements = {
            loading: document.getElementById('loading'),
            quoteContent: document.getElementById('quoteContent'),
            quoteText: document.getElementById('quoteText'),
            quoteAuthor: document.getElementById('quoteAuthor'),
            quoteCategory: document.getElementById('quoteCategory'),
            hamburgerBtn: document.getElementById('hamburgerBtn'),
            sidebar: document.getElementById('sidebar'),
            sidebarOverlay: document.getElementById('sidebarOverlay'),
            sidebarClose: document.getElementById('sidebarClose'),
            newQuoteBtn: document.getElementById('newQuoteBtn'),
            quickNewBtn: document.getElementById('quickNewBtn'),
            favoriteBtn: document.getElementById('favoriteBtn'),
            dateDisplay: document.getElementById('dateDisplay')
        };

        // 메시지 표시 함수
        function showMessage(index = null) {
            try {
                if (index === null) {
                    index = Math.floor(Math.random() * messages.length);
                }
                currentMessageIndex = index;
                
                const message = messages[index];
                
                if (elements.loading) elements.loading.style.display = 'none';
                if (elements.quoteContent) elements.quoteContent.style.display = 'block';
                if (elements.quoteText) elements.quoteText.textContent = message.text;
                if (elements.quoteAuthor) elements.quoteAuthor.textContent = `- ${message.author}`;
                if (elements.quoteCategory) elements.quoteCategory.textContent = `#${message.category}`;
                
                console.log('메시지 표시됨:', message.text);
            } catch (error) {
                console.error('메시지 표시 오류:', error);
            }
        }

        // 사이드바 관리
        function toggleSidebar() {
            if (elements.sidebar) elements.sidebar.classList.toggle('open');
            if (elements.sidebarOverlay) elements.sidebarOverlay.classList.toggle('show');
        }

        function closeSidebar() {
            if (elements.sidebar) elements.sidebar.classList.remove('open');
            if (elements.sidebarOverlay) elements.sidebarOverlay.classList.remove('show');
        }

        // 즐겨찾기 토글
        function toggleFavorite() {
            const icon = elements.favoriteBtn?.querySelector('.favorite-icon');
            if (icon) {
                icon.textContent = icon.textContent === '🤍' ? '❤️' : '🤍';
            }
        }

        // 공유 기능
        function shareMessage() {
            const messageText = elements.quoteText?.textContent || '새로운 하루가 시작됩니다!';
            const shareText = `${messageText}\n\n🌅 모닝 앱에서`;
            
            if (navigator.share) {
                navigator.share({
                    title: '모닝 - 아침 메시지',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('메시지가 클립보드에 복사되었습니다!');
                });
            }
        }

        // 음성 재생
        function speakMessage() {
            const messageText = elements.quoteText?.textContent || '새로운 하루가 시작됩니다!';
            
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(messageText);
                utterance.lang = 'ko-KR';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            } else {
                alert('음성 재생을 지원하지 않는 브라우저입니다.');
            }
        }

        // 이벤트 리스너 설정
        function setupEventListeners() {
            console.log('이벤트 리스너 설정 중...');
            
            // 햄버거 메뉴
            if (elements.hamburgerBtn) {
                elements.hamburgerBtn.addEventListener('click', toggleSidebar);
            }
            
            if (elements.sidebarClose) {
                elements.sidebarClose.addEventListener('click', closeSidebar);
            }
            
            if (elements.sidebarOverlay) {
                elements.sidebarOverlay.addEventListener('click', closeSidebar);
            }
            
            // 새 메시지 버튼들
            if (elements.newQuoteBtn) {
                elements.newQuoteBtn.addEventListener('click', () => {
                    showMessage();
                    closeSidebar();
                });
            }
            
            if (elements.quickNewBtn) {
                elements.quickNewBtn.addEventListener('click', () => showMessage());
            }
            
            // 즐겨찾기 버튼
            if (elements.favoriteBtn) {
                elements.favoriteBtn.addEventListener('click', toggleFavorite);
            }
            
            // 빠른 액션 버튼들
            const quickShareBtn = document.getElementById('quickShareBtn');
            const quickSpeakBtn = document.getElementById('quickSpeakBtn');
            
            if (quickShareBtn) {
                quickShareBtn.addEventListener('click', shareMessage);
            }
            
            if (quickSpeakBtn) {
                quickSpeakBtn.addEventListener('click', speakMessage);
            }
            
            // 기타 메뉴 아이템들
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    const action = this.id.replace('Btn', '');
                    console.log('메뉴 클릭:', action);
                    
                    switch(action) {
                        case 'newQuote':
                            showMessage();
                            break;
                        case 'favorites':
                            alert('즐겨찾기 기능 (준비 중)');
                            break;
                        case 'history':
                            alert('히스토리 기능 (준비 중)');
                            break;
                        case 'journal':
                            alert('일기 기능 (준비 중)');
                            break;
                        case 'goals':
                            alert('목표 기능 (준비 중)');
                            break;
                        case 'settings':
                            alert('설정 기능 (준비 중)');
                            break;
                        default:
                            console.log('알 수 없는 액션:', action);
                    }
                    closeSidebar();
                });
            });
            
            console.log('이벤트 리스너 설정 완료');
        }

        // 날짜 표시
        function displayDate() {
            if (elements.dateDisplay) {
                const today = new Date();
                elements.dateDisplay.textContent = today.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'long'
                });
            }
        }

        // 초기화
        function init() {
            console.log('앱 초기화 시작...');
            
            try {
                setupEventListeners();
                showMessage(0);
                displayDate();
                
                console.log('앱 초기화 완료!');
                
                // 3초 후 오류 알림 숨김
                setTimeout(() => {
                    if (document.getElementById('errorNotice')) {
                        document.getElementById('errorNotice').style.display = 'none';
                    }
                }, 3000);
                
            } catch (error) {
                console.error('초기화 오류:', error);
                document.getElementById('errorNotice').style.display = 'block';
                document.getElementById('errorNotice').textContent = `초기화 오류: ${error.message}`;
            }
        }

        // DOM 로드 완료 후 실행
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        console.log('스크립트 로딩 완료');
    </script>
</body>
</html>