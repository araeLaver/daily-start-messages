<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¨ë‹ - ë¹ ë¥¸ ìˆ˜ì •</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .error-notice {
            position: fixed;
            top: 10px;
            left: 10px;
            background: #ef4444;
            color: white;
            padding: 10px;
            border-radius: 8px;
            z-index: 10000;
            display: none;
        }
    </style>
</head>
<body>
    <div class="error-notice" id="errorNotice">ì˜¤ë¥˜ ë°œê²¬! ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.</div>
    
    <!-- í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ -->
    <button class="hamburger-btn" id="hamburgerBtn" aria-label="ë©”ë‰´ ì—´ê¸°">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- ì‚¬ì´ë“œë°” ë©”ë‰´ -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>ğŸŒ… ëª¨ë‹</h2>
            <button class="sidebar-close" id="sidebarClose">&times;</button>
        </div>
        
        <div class="sidebar-content">
            <div class="user-info">
                <div class="user-greeting">ì•ˆë…•í•˜ì„¸ìš”!</div>
                <div class="user-streak">
                    <span class="streak-icon">ğŸ”¥</span>
                    <span id="streakNumber">0</span>ì¼ ì—°ì† ë°©ë¬¸
                </div>
            </div>

            <div class="menu-section">
                <h3>ğŸ“ ë©”ì‹œì§€</h3>
                <button class="menu-item" id="newQuoteBtn">
                    <span class="menu-icon">ğŸŒ…</span>
                    ìƒˆë¡œìš´ ë©”ì‹œì§€
                </button>
                <button class="menu-item" id="favoritesBtn">
                    <span class="menu-icon">â­</span>
                    ì¦ê²¨ì°¾ê¸°
                </button>
                <button class="menu-item" id="historyBtn">
                    <span class="menu-icon">ğŸ“š</span>
                    íˆìŠ¤í† ë¦¬
                </button>
            </div>

            <div class="menu-section">
                <h3>ğŸ“± ê¸°ëŠ¥</h3>
                <button class="menu-item" id="journalBtn">
                    <span class="menu-icon">ğŸ“</span>
                    ì¼ê¸°
                </button>
                <button class="menu-item" id="goalsBtn">
                    <span class="menu-icon">ğŸ¯</span>
                    ëª©í‘œ
                </button>
            </div>

            <div class="menu-section">
                <h3>âš™ï¸ ì„¤ì •</h3>
                <button class="menu-item" id="settingsBtn">
                    <span class="menu-icon">âš™ï¸</span>
                    ì•± ì„¤ì •
                </button>
            </div>
        </div>
    </nav>

    <!-- ì‚¬ì´ë“œë°” ì˜¤ë²„ë ˆì´ -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content" id="main-content">
        <div class="quote-container">
            <div class="quote-card">
                <div class="loading" id="loading">
                    <div class="loading-spinner"></div>
                    <p>ë©”ì‹œì§€ë¥¼ ì¤€ë¹„í•˜ê³  ìˆì–´ìš”...</p>
                </div>
                <div class="quote-content" id="quoteContent" style="display: none;">
                    <div class="quote-actions">
                        <button class="favorite-btn" id="favoriteBtn">
                            <span class="favorite-icon">ğŸ¤</span>
                        </button>
                    </div>
                    <blockquote class="quote-text" id="quoteText">ë©”ì‹œì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</blockquote>
                    <cite class="quote-author" id="quoteAuthor">- ëª¨ë‹</cite>
                    <div class="quote-category" id="quoteCategory">#ìƒˆë¡œìš´ì‹œì‘</div>
                </div>
            </div>
            
            <div class="quick-actions">
                <button class="quick-action-btn" id="quickNewBtn" title="ìƒˆë¡œìš´ ë©”ì‹œì§€">ğŸ”„</button>
                <button class="quick-action-btn" id="quickShareBtn" title="ê³µìœ í•˜ê¸°">ğŸ“¤</button>
                <button class="quick-action-btn" id="quickSpeakBtn" title="ìŒì„±ë“£ê¸°">ğŸ”Š</button>
            </div>
        </div>
    </main>
    
    <footer class="footer">
        <div class="date-display" id="dateDisplay"></div>
    </footer>

    <script>
        // ì¦‰ì‹œ ì˜¤ë¥˜ ìºì¹˜
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('ì „ì—­ ì˜¤ë¥˜:', msg, 'at', url, ':', lineNo);
            document.getElementById('errorNotice').style.display = 'block';
            document.getElementById('errorNotice').textContent = `ì˜¤ë¥˜: ${msg}`;
            return false;
        };

        window.addEventListener('unhandledrejection', function(event) {
            console.error('Promise ì˜¤ë¥˜:', event.reason);
            document.getElementById('errorNotice').style.display = 'block';
            document.getElementById('errorNotice').textContent = `Promise ì˜¤ë¥˜: ${event.reason}`;
        });

        console.log('ë¹ ë¥¸ ìˆ˜ì • ë²„ì „ ì‹œì‘...');

        // ê¸°ë³¸ ë©”ì‹œì§€ ë°ì´í„° (ì™¸ë¶€ íŒŒì¼ ì˜ì¡´ì„± ì œê±°)
        const messages = [
            { text: "ìƒˆë¡œìš´ í•˜ë£¨ê°€ ì‹œì‘ë©ë‹ˆë‹¤. ì˜¤ëŠ˜ë„ ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”! ğŸŒ…", author: "ëª¨ë‹ íŒ€", category: "morning" },
            { text: "ì‘ì€ ê±¸ìŒë„ ì•ìœ¼ë¡œ ë‚˜ì•„ê°€ëŠ” ê²ƒì…ë‹ˆë‹¤.", author: "ìµëª…", category: "motivation" },
            { text: "ì˜¤ëŠ˜ í•˜ë£¨ë„ ê°ì‚¬í•œ ë§ˆìŒìœ¼ë¡œ ì‹œì‘í•´ë³´ì„¸ìš”.", author: "ëª¨ë‹ íŒ€", category: "gratitude" },
            { text: "ë‹¹ì‹ ì˜ ê¿ˆì€ ì¶©ë¶„íˆ ê°€ì¹˜ê°€ ìˆìŠµë‹ˆë‹¤.", author: "ìµëª…", category: "dreams" },
            { text: "ì§€ê¸ˆ ì´ ìˆœê°„ì´ ìƒˆë¡œìš´ ì‹œì‘ì˜ ê¸°íšŒì…ë‹ˆë‹¤.", author: "ëª¨ë‹ íŒ€", category: "opportunity" }
        ];

        let currentMessageIndex = 0;

        // DOM ìš”ì†Œë“¤
        const elements = {
            loading: document.getElementById('loading'),
            quoteContent: document.getElementById('quoteContent'),
            quoteText: document.getElementById('quoteText'),
            quoteAuthor: document.getElementById('quoteAuthor'),
            quoteCategory: document.getElementById('quoteCategory'),
            hamburgerBtn: document.getElementById('hamburgerBtn'),
            sidebar: document.getElementById('sidebar'),
            sidebarOverlay: document.getElementById('sidebarOverlay'),
            sidebarClose: document.getElementById('sidebarClose'),
            newQuoteBtn: document.getElementById('newQuoteBtn'),
            quickNewBtn: document.getElementById('quickNewBtn'),
            favoriteBtn: document.getElementById('favoriteBtn'),
            dateDisplay: document.getElementById('dateDisplay')
        };

        // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showMessage(index = null) {
            try {
                if (index === null) {
                    index = Math.floor(Math.random() * messages.length);
                }
                currentMessageIndex = index;
                
                const message = messages[index];
                
                if (elements.loading) elements.loading.style.display = 'none';
                if (elements.quoteContent) elements.quoteContent.style.display = 'block';
                if (elements.quoteText) elements.quoteText.textContent = message.text;
                if (elements.quoteAuthor) elements.quoteAuthor.textContent = `- ${message.author}`;
                if (elements.quoteCategory) elements.quoteCategory.textContent = `#${message.category}`;
                
                console.log('ë©”ì‹œì§€ í‘œì‹œë¨:', message.text);
            } catch (error) {
                console.error('ë©”ì‹œì§€ í‘œì‹œ ì˜¤ë¥˜:', error);
            }
        }

        // ì‚¬ì´ë“œë°” ê´€ë¦¬
        function toggleSidebar() {
            if (elements.sidebar) elements.sidebar.classList.toggle('open');
            if (elements.sidebarOverlay) elements.sidebarOverlay.classList.toggle('show');
        }

        function closeSidebar() {
            if (elements.sidebar) elements.sidebar.classList.remove('open');
            if (elements.sidebarOverlay) elements.sidebarOverlay.classList.remove('show');
        }

        // ì¦ê²¨ì°¾ê¸° í† ê¸€
        function toggleFavorite() {
            const icon = elements.favoriteBtn?.querySelector('.favorite-icon');
            if (icon) {
                icon.textContent = icon.textContent === 'ğŸ¤' ? 'â¤ï¸' : 'ğŸ¤';
            }
        }

        // ê³µìœ  ê¸°ëŠ¥
        function shareMessage() {
            const messageText = elements.quoteText?.textContent || 'ìƒˆë¡œìš´ í•˜ë£¨ê°€ ì‹œì‘ë©ë‹ˆë‹¤!';
            const shareText = `${messageText}\n\nğŸŒ… ëª¨ë‹ ì•±ì—ì„œ`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'ëª¨ë‹ - ì•„ì¹¨ ë©”ì‹œì§€',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('ë©”ì‹œì§€ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                });
            }
        }

        // ìŒì„± ì¬ìƒ
        function speakMessage() {
            const messageText = elements.quoteText?.textContent || 'ìƒˆë¡œìš´ í•˜ë£¨ê°€ ì‹œì‘ë©ë‹ˆë‹¤!';
            
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(messageText);
                utterance.lang = 'ko-KR';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            } else {
                alert('ìŒì„± ì¬ìƒì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì¤‘...');
            
            // í–„ë²„ê±° ë©”ë‰´
            if (elements.hamburgerBtn) {
                elements.hamburgerBtn.addEventListener('click', toggleSidebar);
            }
            
            if (elements.sidebarClose) {
                elements.sidebarClose.addEventListener('click', closeSidebar);
            }
            
            if (elements.sidebarOverlay) {
                elements.sidebarOverlay.addEventListener('click', closeSidebar);
            }
            
            // ìƒˆ ë©”ì‹œì§€ ë²„íŠ¼ë“¤
            if (elements.newQuoteBtn) {
                elements.newQuoteBtn.addEventListener('click', () => {
                    showMessage();
                    closeSidebar();
                });
            }
            
            if (elements.quickNewBtn) {
                elements.quickNewBtn.addEventListener('click', () => showMessage());
            }
            
            // ì¦ê²¨ì°¾ê¸° ë²„íŠ¼
            if (elements.favoriteBtn) {
                elements.favoriteBtn.addEventListener('click', toggleFavorite);
            }
            
            // ë¹ ë¥¸ ì•¡ì…˜ ë²„íŠ¼ë“¤
            const quickShareBtn = document.getElementById('quickShareBtn');
            const quickSpeakBtn = document.getElementById('quickSpeakBtn');
            
            if (quickShareBtn) {
                quickShareBtn.addEventListener('click', shareMessage);
            }
            
            if (quickSpeakBtn) {
                quickSpeakBtn.addEventListener('click', speakMessage);
            }
            
            // ê¸°íƒ€ ë©”ë‰´ ì•„ì´í…œë“¤
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    const action = this.id.replace('Btn', '');
                    console.log('ë©”ë‰´ í´ë¦­:', action);
                    
                    switch(action) {
                        case 'newQuote':
                            showMessage();
                            break;
                        case 'favorites':
                            alert('ì¦ê²¨ì°¾ê¸° ê¸°ëŠ¥ (ì¤€ë¹„ ì¤‘)');
                            break;
                        case 'history':
                            alert('íˆìŠ¤í† ë¦¬ ê¸°ëŠ¥ (ì¤€ë¹„ ì¤‘)');
                            break;
                        case 'journal':
                            alert('ì¼ê¸° ê¸°ëŠ¥ (ì¤€ë¹„ ì¤‘)');
                            break;
                        case 'goals':
                            alert('ëª©í‘œ ê¸°ëŠ¥ (ì¤€ë¹„ ì¤‘)');
                            break;
                        case 'settings':
                            alert('ì„¤ì • ê¸°ëŠ¥ (ì¤€ë¹„ ì¤‘)');
                            break;
                        default:
                            console.log('ì•Œ ìˆ˜ ì—†ëŠ” ì•¡ì…˜:', action);
                    }
                    closeSidebar();
                });
            });
            
            console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
        }

        // ë‚ ì§œ í‘œì‹œ
        function displayDate() {
            if (elements.dateDisplay) {
                const today = new Date();
                elements.dateDisplay.textContent = today.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'long'
                });
            }
        }

        // ì´ˆê¸°í™”
        function init() {
            console.log('ì•± ì´ˆê¸°í™” ì‹œì‘...');
            
            try {
                setupEventListeners();
                showMessage(0);
                displayDate();
                
                console.log('ì•± ì´ˆê¸°í™” ì™„ë£Œ!');
                
                // 3ì´ˆ í›„ ì˜¤ë¥˜ ì•Œë¦¼ ìˆ¨ê¹€
                setTimeout(() => {
                    if (document.getElementById('errorNotice')) {
                        document.getElementById('errorNotice').style.display = 'none';
                    }
                }, 3000);
                
            } catch (error) {
                console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                document.getElementById('errorNotice').style.display = 'block';
                document.getElementById('errorNotice').textContent = `ì´ˆê¸°í™” ì˜¤ë¥˜: ${error.message}`;
            }
        }

        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì‹¤í–‰
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        console.log('ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì™„ë£Œ');
    </script>
</body>
</html>